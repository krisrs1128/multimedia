<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Illustration with Nonlinear Effects • multimedia</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Illustration with Nonlinear Effects">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">multimedia</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/IBD.html">Microbiome - Metabolome Mediation Analysis</a>
    </li>
    <li>
      <a href="../articles/illustration.html">Illustration with Nonlinear Effects</a>
    </li>
    <li>
      <a href="../articles/mindfulness.html">The Mindfulness Study</a>
    </li>
    <li>
      <a href="../articles/random.html">Quick Start with Random Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/krisrs1128/multimedia/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Illustration with Nonlinear Effects</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/krisrs1128/multimedia/blob/HEAD/vignettes/illustration.Rmd" class="external-link"><code>vignettes/illustration.Rmd</code></a></small>
      <div class="hidden name"><code>illustration.Rmd</code></div>

    </div>

    
    
<p>This vignette gives a simplified example similar to the “Quick Start
with Random Data,” except in this simulated dataset, there are true
direct and indirect effects. The data are low dimensional, which also
makes it easy to visualize our model’s behavior and the effect of
various alterations. Before discussing data and models, let’s load
libraries and define helper functions that will be used for reorganizing
the data later in this vignette.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glue.tidyverse.org/" class="external-link">glue</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://krisrs1128.github.io/multimedia" class="external-link">multimedia</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">20240111</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Helper to plot the real data</span></span>
<span><span class="va">plot_exper</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit</span>, <span class="va">profile</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">pivot_samples</span><span class="op">(</span><span class="va">fit</span>, <span class="va">profile</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">mediator</span>, <span class="va">value</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">outcome</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Convert a SummarizedExperiment to long form</span></span>
<span><span class="va">pivot_samples</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit</span>, <span class="va">profile</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">exper_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">fit</span>, profile <span class="op">=</span> <span class="va">profile</span><span class="op">)</span></span>
<span>    <span class="fu">outcomes</span><span class="op">(</span><span class="va">exper_sample</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="fu">mediators</span><span class="op">(</span><span class="va">exper_sample</span><span class="op">)</span>, <span class="va">t_outcome</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"outcome"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"outcome"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We will consdier a mediation analysis with two outcomes and a single
mediator. The toy dataset below is included in the package – you can
vary the number of samples and true direct effect size by passing in
arguments.</p>
<p>the treatment, mediator, and outcomes. We use random spline functions
for the direct effect.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xy_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/demo_spline.html">demo_spline</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">xy_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    true <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">xy_data</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"outcome"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"outcome"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The block below estimates a random forest model on these randomly
generated data (after first converting them into an object of class
<code>mediation_data</code>). We can vary <code>ranger</code> parameters
using the arguments to <code><a href="../reference/rf_model.html">rf_model()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exper</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mediation_data.html">mediation_data</a></span><span class="op">(</span></span>
<span>    <span class="va">xy_data</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"outcome"</span><span class="op">)</span>, <span class="st">"treatment"</span>, <span class="st">"mediator"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multimedia.html">multimedia</a></span><span class="op">(</span></span>
<span>    <span class="va">exper</span>,</span>
<span>    outcome_estimator <span class="op">=</span> <span class="fu"><a href="../reference/rf_model.html">rf_model</a></span><span class="op">(</span>num.trees <span class="op">=</span> <span class="fl">1e3</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/estimate.html">estimate</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span></span></code></pre></div>
<p>Let’s look at the estimated effects.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/direct_effect.html">direct_effect</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/effect_summary.html">effect_summary</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span><span class="co">#&gt;   outcome   direct_effect</span></span>
<span><span class="co">#&gt;                </span></span>
<span><span class="co">#&gt; 1 outcome_1         -1.57</span></span>
<span><span class="co">#&gt; 2 outcome_2         -2.16</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/indirect_overall.html">indirect_overall</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/effect_summary.html">effect_summary</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span><span class="co">#&gt;   outcome   indirect_effect</span></span>
<span><span class="co">#&gt;                  </span></span>
<span><span class="co">#&gt; 1 outcome_1           0.732</span></span>
<span><span class="co">#&gt; 2 outcome_2          -1.53</span></span></code></pre>
<p>Mediation analysis depends on untestable assumptions on the absence
of confounders that influence both the mediators and outcome. For this
reason, we can run a sensitivity analysis: How strong would the
confounder have to be before we would observe a flipped indirect effect
estimate?</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">confound_ix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>mediator <span class="op">=</span> <span class="fl">1</span>, outcome <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># sensitivity_curve &lt;- sensitivity(fit, exper, confound_ix)</span></span>
<span><span class="va">sensitivity_curve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"https://go.wisc.edu/0xcyr1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_sensitivity.html">plot_sensitivity</a></span><span class="op">(</span><span class="va">sensitivity_curve</span><span class="op">)</span></span></code></pre></div>
<p><img src="illustration_files/figure-html/sensitivity_analysis-1.png" width="600" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perturb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">0</span>,</span>
<span>        <span class="fl">3</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>        <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span></span>
<span>    <span class="op">)</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># sensitivity_curve &lt;- sensitivity_perturb(fit, exper, perturb)</span></span>
<span><span class="va">sensitivity_curve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"https://go.wisc.edu/75mz1b"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_sensitivity.html">plot_sensitivity</a></span><span class="op">(</span><span class="va">sensitivity_curve</span>, x_var <span class="op">=</span> <span class="st">"nu"</span><span class="op">)</span></span></code></pre></div>
<p><img src="illustration_files/figure-html/unnamed-chunk-2-1.png" width="600" style="display: block; margin: auto;"></p>
<p>If we want to look at samples at new treatment assignments, we have
to first construct a new treatment profile. We can accomplish this using
the <code>setup_profile</code> object.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t_mediator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">t_outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">profile</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_profile.html">setup_profile</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">t_mediator</span>, <span class="va">t_outcome</span><span class="op">)</span></span>
<span><span class="va">xy_long</span><span class="op">[[</span><span class="st">"fitted"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">pivot_samples</span><span class="op">(</span><span class="va">fit</span>, <span class="va">profile</span><span class="op">)</span></span></code></pre></div>
<p>Let’s estimate three altered models. The first two nullify the
effects in the mediation and outcome models, respectively. The third
assumes a linear, rather than random forest, outcome model.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">altered_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nullify.html">nullify</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"T-&gt;M"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/estimate.html">estimate</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span></span>
<span><span class="va">altered_ty</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nullify.html">nullify</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"T-&gt;Y"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/estimate.html">estimate</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multimedia.html">multimedia</a></span><span class="op">(</span></span>
<span>    <span class="va">exper</span>,</span>
<span>    outcome_estimator <span class="op">=</span> <span class="fu"><a href="../reference/lm_model.html">lm_model</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/estimate.html">estimate</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span></span></code></pre></div>
<p>We can sample from these models and organize the results into one
long data.frame. The function <code>pivot_samples</code> is defined at
the top of the script.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pretty_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Original Data"</span>, <span class="st">"RF (Full)"</span>, <span class="st">"RF (T-\\-&gt;M)"</span>, <span class="st">"RF (T-\\-&gt;Y)"</span>, <span class="st">"Linear Model"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">xy_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="va">xy_long</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        altered_m <span class="op">=</span> <span class="fu">pivot_samples</span><span class="op">(</span><span class="va">altered_m</span>, <span class="va">profile</span><span class="op">)</span>,</span>
<span>        altered_ty <span class="op">=</span> <span class="fu">pivot_samples</span><span class="op">(</span><span class="va">altered_ty</span>, <span class="va">profile</span><span class="op">)</span>,</span>
<span>        linear <span class="op">=</span> <span class="fu">pivot_samples</span><span class="op">(</span><span class="va">fit_lm</span>, <span class="va">profile</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"fit_type"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        fit_type <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">fit_type</span> <span class="op">==</span> <span class="st">"linear"</span> <span class="op">~</span> <span class="st">"Linear Model"</span>,</span>
<span>            <span class="va">fit_type</span> <span class="op">==</span> <span class="st">"true"</span> <span class="op">~</span> <span class="st">"Original Data"</span>,</span>
<span>            <span class="va">fit_type</span> <span class="op">==</span> <span class="st">"fitted"</span> <span class="op">~</span> <span class="st">"RF (Full)"</span>,</span>
<span>            <span class="va">fit_type</span> <span class="op">==</span> <span class="st">"altered_ty"</span> <span class="op">~</span> <span class="st">"RF (T-\\-&gt;Y)"</span>,</span>
<span>            <span class="va">fit_type</span> <span class="op">==</span> <span class="st">"altered_m"</span> <span class="op">~</span> <span class="st">"RF (T-\\-&gt;M)"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        fit_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">fit_type</span>, levels <span class="op">=</span> <span class="va">pretty_labels</span><span class="op">)</span>,</span>
<span>        outcome <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">outcome</span> <span class="op">==</span> <span class="st">"outcome_1"</span> <span class="op">~</span> <span class="st">"Y[1]"</span>,</span>
<span>            <span class="va">outcome</span> <span class="op">==</span> <span class="st">"outcome_2"</span> <span class="op">~</span> <span class="st">"Y[2]"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p>The figure below compares the original data and model with the
various nullified versions, using the combined <code>xy_long</code>
dataset constructed above.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xy_long</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_frac</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">mediator</span>, col <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.4</span>, alpha <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html" class="external-link">geom_rug</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.99</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">fit_type</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Mediator M"</span><span class="op">)</span>, y <span class="op">=</span> <span class="st">"Outcome"</span>, col <span class="op">=</span> <span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>        strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>,</span>
<span>        axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p><img src="illustration_files/figure-html/visualize_long-1.png" width="600" style="display: block; margin: auto;"></p>
<p>We can calculate bootstrap confidence intervals for the direct and
overall indirect effects using the block below.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>direct_effect <span class="op">=</span> <span class="va">direct_effect</span>, indirect_overall <span class="op">=</span> <span class="va">indirect_overall</span><span class="op">)</span></span>
<span><span class="co"># bootstraps &lt;- bootstrap(fit, exper, fs = fs)</span></span>
<span><span class="va">bootstraps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">url</a></span><span class="op">(</span><span class="st">"https://go.wisc.edu/977l04"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">bootstraps</span><span class="op">$</span><span class="va">direct_effect</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">direct_effect</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">outcome</span><span class="op">)</span></span></code></pre></div>
<p><img src="illustration_files/figure-html/bootstraps-1.png" width="600" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">bootstraps</span><span class="op">$</span><span class="va">indirect_overall</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">indirect_effect</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">outcome</span><span class="op">)</span></span></code></pre></div>
<p><img src="illustration_files/figure-html/bootstraps-2.png" width="600" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; R version 4.4.1 (2024-06-14)</span></span>
<span><span class="co">#&gt; Platform: aarch64-apple-darwin20</span></span>
<span><span class="co">#&gt; Running under: macOS Sonoma 14.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib </span></span>
<span><span class="co">#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt; [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: America/Chicago</span></span>
<span><span class="co">#&gt; tzcode source: internal</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">#&gt; [8] base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt;  [1] multimedia_0.1.0            tidyselect_1.2.1           </span></span>
<span><span class="co">#&gt;  [3] SummarizedExperiment_1.35.1 Biobase_2.65.0             </span></span>
<span><span class="co">#&gt;  [5] GenomicRanges_1.57.1        GenomeInfoDb_1.41.1        </span></span>
<span><span class="co">#&gt;  [7] IRanges_2.39.2              S4Vectors_0.43.2           </span></span>
<span><span class="co">#&gt;  [9] BiocGenerics_0.51.0         MatrixGenerics_1.17.0      </span></span>
<span><span class="co">#&gt; [11] matrixStats_1.3.0           lubridate_1.9.3            </span></span>
<span><span class="co">#&gt; [13] forcats_1.0.0               stringr_1.5.1              </span></span>
<span><span class="co">#&gt; [15] dplyr_1.1.4                 purrr_1.0.2                </span></span>
<span><span class="co">#&gt; [17] readr_2.1.5                 tidyr_1.3.1                </span></span>
<span><span class="co">#&gt; [19] tibble_3.2.1                tidyverse_2.0.0            </span></span>
<span><span class="co">#&gt; [21] glue_1.7.0                  ggplot2_3.5.1              </span></span>
<span><span class="co">#&gt; [23] BiocStyle_2.33.1           </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] permute_0.9-7           rlang_1.1.4             magrittr_2.0.3         </span></span>
<span><span class="co">#&gt;  [4] ade4_1.7-22             compiler_4.4.1          mgcv_1.9-1             </span></span>
<span><span class="co">#&gt;  [7] systemfonts_1.1.0       vctrs_0.6.5             reshape2_1.4.4         </span></span>
<span><span class="co">#&gt; [10] pkgconfig_2.0.3         crayon_1.5.3            fastmap_1.2.0          </span></span>
<span><span class="co">#&gt; [13] XVector_0.45.0          labeling_0.4.3          utf8_1.2.4             </span></span>
<span><span class="co">#&gt; [16] rmarkdown_2.28          tzdb_0.4.0              UCSC.utils_1.1.0       </span></span>
<span><span class="co">#&gt; [19] ragg_1.3.2              bit_4.0.5               xfun_0.47              </span></span>
<span><span class="co">#&gt; [22] zlibbioc_1.51.1         cachem_1.1.0            jsonlite_1.8.8         </span></span>
<span><span class="co">#&gt; [25] biomformat_1.33.0       progress_1.2.3          highr_0.11             </span></span>
<span><span class="co">#&gt; [28] rhdf5filters_1.17.0     DelayedArray_0.31.11    Rhdf5lib_1.27.0        </span></span>
<span><span class="co">#&gt; [31] parallel_4.4.1          prettyunits_1.2.0       cluster_2.1.6          </span></span>
<span><span class="co">#&gt; [34] R6_2.5.1                bslib_0.8.0             stringi_1.8.4          </span></span>
<span><span class="co">#&gt; [37] ranger_0.16.0           jquerylib_0.1.4         Rcpp_1.0.13            </span></span>
<span><span class="co">#&gt; [40] bookdown_0.40           iterators_1.0.14        knitr_1.48             </span></span>
<span><span class="co">#&gt; [43] timechange_0.3.0        Matrix_1.7-0            splines_4.4.1          </span></span>
<span><span class="co">#&gt; [46] igraph_2.0.3            abind_1.4-5             yaml_2.3.10            </span></span>
<span><span class="co">#&gt; [49] vegan_2.6-8             codetools_0.2-20        curl_5.2.1             </span></span>
<span><span class="co">#&gt; [52] lattice_0.22-6          plyr_1.8.9              withr_3.0.1            </span></span>
<span><span class="co">#&gt; [55] evaluate_0.24.0         desc_1.4.3              survival_3.7-0         </span></span>
<span><span class="co">#&gt; [58] Biostrings_2.73.1       pillar_1.9.0            BiocManager_1.30.24    </span></span>
<span><span class="co">#&gt; [61] phyloseq_1.49.0         foreach_1.5.2           insight_0.20.3         </span></span>
<span><span class="co">#&gt; [64] generics_0.1.3          vroom_1.6.5             hms_1.1.3              </span></span>
<span><span class="co">#&gt; [67] munsell_0.5.1           scales_1.3.0            tools_4.4.1            </span></span>
<span><span class="co">#&gt; [70] data.table_1.16.0       fs_1.6.4                tidygraph_1.3.1        </span></span>
<span><span class="co">#&gt; [73] rhdf5_2.49.0            grid_4.4.1              ape_5.8                </span></span>
<span><span class="co">#&gt; [76] colorspace_2.1-1        nlme_3.1-166            formula.tools_1.7.1    </span></span>
<span><span class="co">#&gt; [79] GenomeInfoDbData_1.2.12 cli_3.6.3               textshaping_0.4.0      </span></span>
<span><span class="co">#&gt; [82] fansi_1.0.6             S4Arrays_1.5.7          gtable_0.3.5           </span></span>
<span><span class="co">#&gt; [85] sass_0.4.9              digest_0.6.37           operator.tools_1.6.3   </span></span>
<span><span class="co">#&gt; [88] SparseArray_1.5.31      farver_2.1.2            htmlwidgets_1.6.4      </span></span>
<span><span class="co">#&gt; [91] htmltools_0.5.8.1       pkgdown_2.1.0           multtest_2.61.0        </span></span>
<span><span class="co">#&gt; [94] lifecycle_1.0.4         httr_1.4.7              bit64_4.0.5            </span></span>
<span><span class="co">#&gt; [97] MASS_7.3-61</span></span></code></pre>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Kris Sankaran, Hanying Jiang.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
