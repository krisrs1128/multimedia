<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Mindfulness Study • multimedia</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="The Mindfulness Study">
<meta property="og:description" content="multimedia">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">multimedia</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/IBD.html">Microbiome - Metabolome Mediation Analysis</a>
    </li>
    <li>
      <a href="../articles/illustration.html">Illustration with Nonlinear Effects</a>
    </li>
    <li>
      <a href="../articles/mindfulness.html">The Mindfulness Study</a>
    </li>
    <li>
      <a href="../articles/random.html">Quick Start with Random Data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>The Mindfulness Study</h1>
            
      
      
      <div class="hidden name"><code>mindfulness.Rmd</code></div>

    </div>

    
    
<p>In most microbiome mediation analysis studies, microbiome composition
is thought to mediate some outcome of interest. Sometimes, though, we
might want to treat the microbiome as an outcome. Our motivating example
here looks at the relationship between mindfulness and the microbiome.
In this setting, we might imagine that mindfulness training influences
behaviors (diet, sleep, exercise) that could then change the microbiome.
Clinical surveys that gauge those behaviors now play the role of
mediator. Alternatively, mindfulness could trigger neurophysiological
changes that influence the microbiome in more subtle ways. The point of
mediation analysis is to provide evidence for one or the other of these
possibilities.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/ggdist/" class="external-link">ggdist</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggrepel.slowkow.com/" class="external-link">ggrepel</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://dx.plos.org/10.1371/journal.pone.0061217" class="external-link">phyloseq</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">multimedia</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mindfulness</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">20231228</span><span class="op">)</span></span></code></pre></div>
<p>This package needs a <code>mediation_data</code> object to organize
the pretreatment, treatment, mediator, and outcome variables.
<code>taxa_names(mindfulness)</code> specifies that we want all the taxa
names to be outcome variables. We’ve already appended all the mediator
variable names with the prefix “mediator,” so we can specify them using
the <code>starts_with</code> selector. We’ll treat the
<code>subject</code> column as pretreatment variables. The study tracked
participants across a few timepoints, and we want to control for
different baseline behavioral and microbiome profiles.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exper</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mediation_data.html">mediation_data</a></span><span class="op">(</span></span>
<span>  <span class="va">mindfulness</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/taxa_names-methods.html" class="external-link">taxa_names</a></span><span class="op">(</span><span class="va">mindfulness</span><span class="op">)</span>,</span>
<span>  <span class="st">"treatment"</span>,</span>
<span>  <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"mediator"</span><span class="op">)</span>,</span>
<span>  <span class="st">"subject"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">exper</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; [Mediation Data] </span></span>
<span><span class="co">#&gt; 307 samples with measurements for, </span></span>
<span><span class="co">#&gt; 1 treatment: treatment </span></span>
<span><span class="co">#&gt; 4 mediators: mediator.sleepDistRaw, mediator.fatigueRaw, ... </span></span>
<span><span class="co">#&gt; 55 outcomes: Defluviitalea, Gordonibacter, ... </span></span>
<span><span class="co">#&gt; 1 pretreatment: subject</span></span></code></pre>
<p>This block applies a logistic-normal multinomial model to the
microbiome outcome. This is an example where the response variables are
all modeled jointly. We’ll use a ridge regression model for each of the
mediators. This is a better choice than ordinary linear models because
we have to estimate many subject-level parameters, and our sample size
is not that large.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use Flavonifractor as the reference for the log-ratio transform</span></span>
<span><span class="va">exper</span><span class="op">@</span><span class="va">outcomes</span> <span class="op">&lt;-</span> <span class="va">exper</span><span class="op">@</span><span class="va">outcomes</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Flavonifractor</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multimedia.html">multimedia</a></span><span class="op">(</span></span>
<span>  <span class="va">exper</span>,</span>
<span>  <span class="fu"><a href="../reference/lnm_model.html">lnm_model</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="va">.Random.seed</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/glmnet_model.html">glmnet_model</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/estimate.html">estimate</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; EXPERIMENTAL ALGORITHM: </span></span>
<span><span class="co">#&gt;   This procedure has not been thoroughly tested and may be unstable </span></span>
<span><span class="co">#&gt;   or buggy. The interface is subject to change. </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; Gradient evaluation took 0.008221 seconds </span></span>
<span><span class="co">#&gt; 1000 transitions using 10 leapfrog steps per transition would take 82.21 seconds. </span></span>
<span><span class="co">#&gt; Adjust your expectations accordingly! </span></span>
<span><span class="co">#&gt; Begin eta adaptation. </span></span>
<span><span class="co">#&gt; Iteration:   1 / 250 [  0%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration:  50 / 250 [ 20%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 100 / 250 [ 40%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 150 / 250 [ 60%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 200 / 250 [ 80%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Success! Found best value [eta = 1] earlier than expected. </span></span>
<span><span class="co">#&gt; Begin stochastic gradient ascent. </span></span>
<span><span class="co">#&gt;   iter             ELBO   delta_ELBO_mean   delta_ELBO_med   notes  </span></span>
<span><span class="co">#&gt;    100      -243307.612             1.000            1.000 </span></span>
<span><span class="co">#&gt;    200       -99580.409             1.222            1.443 </span></span>
<span><span class="co">#&gt;    300       -90008.408             0.850            1.000 </span></span>
<span><span class="co">#&gt;    400       -87376.289             0.645            1.000 </span></span>
<span><span class="co">#&gt;    500       -85962.756             0.519            0.106 </span></span>
<span><span class="co">#&gt;    600       -85132.538             0.434            0.106 </span></span>
<span><span class="co">#&gt;    700       -84674.011             0.373            0.030 </span></span>
<span><span class="co">#&gt;    800       -84249.244             0.327            0.030 </span></span>
<span><span class="co">#&gt;    900       -84035.521             0.291            0.016 </span></span>
<span><span class="co">#&gt;   1000       -83782.160             0.262            0.016 </span></span>
<span><span class="co">#&gt;   1100       -83487.854             0.163            0.010   MEDIAN ELBO CONVERGED </span></span>
<span><span class="co">#&gt; Drawing a sample of size 1000 from the approximate posterior...  </span></span>
<span><span class="co">#&gt; COMPLETED. </span></span>
<span><span class="co">#&gt; Finished in  16.6 seconds.</span></span></code></pre>
<div class="section level2">
<h2 id="evaluating-effects">Evaluating Effects<a class="anchor" aria-label="anchor" href="#evaluating-effects"></a>
</h2>
<p>With this model, we can estimate direct and indirect effects. We’re
averaging over different settings of the mediator treatment variables.
Since the LNM model outputs relative abundance profiles, all the
estimated effects should be interpreted on a probability scale.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">direct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/direct_effect.html">direct_effect</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span><span class="op">)</span></span>
<span><span class="va">direct</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>direct_effect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">direct_effect</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">direct_effect</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; # A tibble: 55 × 2</span></span>
<span><span class="co">#&gt;    outcome          direct_effect</span></span>
<span><span class="co">#&gt;                        </span></span>
<span><span class="co">#&gt;  1 Blautia               -0.0597 </span></span>
<span><span class="co">#&gt;  2 Faecalibacterium      -0.0315 </span></span>
<span><span class="co">#&gt;  3 Bifidobacterium        0.0146 </span></span>
<span><span class="co">#&gt;  4 Prevotella             0.00965</span></span>
<span><span class="co">#&gt;  5 Clostridium_XlVa       0.00711</span></span>
<span><span class="co">#&gt;  6 Ruminococcus           0.00695</span></span>
<span><span class="co">#&gt;  7 Dorea                  0.00677</span></span>
<span><span class="co">#&gt;  8 Clostridium_IV        -0.00613</span></span>
<span><span class="co">#&gt;  9 Roseburia             -0.00488</span></span>
<span><span class="co">#&gt; 10 Oscillibacter          0.00480</span></span>
<span><span class="co">#&gt; # ℹ 45 more rows</span></span></code></pre>
<p>These are the indirect effects when we set mediators to the treatment
setting one at a time.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">indirect</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/indirect_pathwise.html">indirect_pathwise</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">mediator</span>, <span class="va">outcome</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>indirect_effect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">indirect_effect</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">indirect_effect</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">indirect</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; # A tibble: 220 × 3</span></span>
<span><span class="co">#&gt; # Groups:   mediator [4]</span></span>
<span><span class="co">#&gt;    mediator                    outcome          indirect_effect</span></span>
<span><span class="co">#&gt;                                                 </span></span>
<span><span class="co">#&gt;  1 mediator.Fruit..not.juices. Faecalibacterium         0.00813</span></span>
<span><span class="co">#&gt;  2 mediator.sleepDistRaw       Faecalibacterium        -0.00810</span></span>
<span><span class="co">#&gt;  3 mediator.sleepDistRaw       Roseburia               -0.00710</span></span>
<span><span class="co">#&gt;  4 mediator.fatigueRaw         Blautia                 -0.00683</span></span>
<span><span class="co">#&gt;  5 mediator.fatigueRaw         Faecalibacterium         0.00547</span></span>
<span><span class="co">#&gt;  6 mediator.fatigueRaw         Roseburia                0.00467</span></span>
<span><span class="co">#&gt;  7 mediator.Fruit..not.juices. Ruminococcus             0.00354</span></span>
<span><span class="co">#&gt;  8 mediator.sleepDistRaw       Blautia                  0.00301</span></span>
<span><span class="co">#&gt;  9 mediator.Cold.cereal        Blautia                  0.00216</span></span>
<span><span class="co">#&gt; 10 mediator.Fruit..not.juices. Blautia                  0.00210</span></span>
<span><span class="co">#&gt; # ℹ 210 more rows</span></span></code></pre>
<p><code>plot_mediators</code> visualizes the relationship between
mediator and outcome variables. The title for each subplot is the
estimated indirect effect (note that it’s <code>Control</code> -
<code>Treatment</code> in the current definition). For example, in the
panel relating sleep disturbances and Blautia, there is a rough positive
association between these variables. The control group has a higher
number of sleep disturbances, which is translated into a positive
indirect effect for this pair. The model accounts for more than these
pairwise relationships, though – it controls for subject-level baselines
and includes direct effects of treatment – so these figures should be
interpreted within the larger model context.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exper_rela</span> <span class="op">&lt;-</span> <span class="va">exper</span></span>
<span><span class="va">exper_rela</span><span class="op">@</span><span class="va">outcomes</span> <span class="op">&lt;-</span> <span class="fu">normalize</span><span class="op">(</span><span class="va">exper</span><span class="op">@</span><span class="va">outcomes</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_mediators.html">plot_mediators</a></span><span class="op">(</span><span class="va">indirect</span>, <span class="va">exper_rela</span><span class="op">)</span></span></code></pre></div>
<p><img src="mindfulness_files/figure-html/mediator_plot-1.png" width="600" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="model-alterations">Model Alterations<a class="anchor" aria-label="anchor" href="#model-alterations"></a>
</h2>
<p>Hypothesis testing is built on the idea that a simple submodel might
explain the data just as well as a full, more complicated one. In
mediation analysis, we can zero out sets of edges to define submodels.
For example, we can re-estimate a model that does not allow any
relationship between the treatment and the mediators.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">altered</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/nullify.html">nullify</a></span><span class="op">(</span><span class="st">"T-&gt;M"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/estimate.html">estimate</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; EXPERIMENTAL ALGORITHM: </span></span>
<span><span class="co">#&gt;   This procedure has not been thoroughly tested and may be unstable </span></span>
<span><span class="co">#&gt;   or buggy. The interface is subject to change. </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; Gradient evaluation took 0.007883 seconds </span></span>
<span><span class="co">#&gt; 1000 transitions using 10 leapfrog steps per transition would take 78.83 seconds. </span></span>
<span><span class="co">#&gt; Adjust your expectations accordingly! </span></span>
<span><span class="co">#&gt; Begin eta adaptation. </span></span>
<span><span class="co">#&gt; Iteration:   1 / 250 [  0%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration:  50 / 250 [ 20%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 100 / 250 [ 40%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 150 / 250 [ 60%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 200 / 250 [ 80%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Success! Found best value [eta = 1] earlier than expected. </span></span>
<span><span class="co">#&gt; Begin stochastic gradient ascent. </span></span>
<span><span class="co">#&gt;   iter             ELBO   delta_ELBO_mean   delta_ELBO_med   notes  </span></span>
<span><span class="co">#&gt;    100      -243307.612             1.000            1.000 </span></span>
<span><span class="co">#&gt;    200       -99580.409             1.222            1.443 </span></span>
<span><span class="co">#&gt;    300       -90008.408             0.850            1.000 </span></span>
<span><span class="co">#&gt;    400       -87376.289             0.645            1.000 </span></span>
<span><span class="co">#&gt;    500       -85962.756             0.519            0.106 </span></span>
<span><span class="co">#&gt;    600       -85132.538             0.434            0.106 </span></span>
<span><span class="co">#&gt;    700       -84674.011             0.373            0.030 </span></span>
<span><span class="co">#&gt;    800       -84249.244             0.327            0.030 </span></span>
<span><span class="co">#&gt;    900       -84035.521             0.291            0.016 </span></span>
<span><span class="co">#&gt;   1000       -83782.160             0.262            0.016 </span></span>
<span><span class="co">#&gt;   1100       -83487.854             0.163            0.010   MEDIAN ELBO CONVERGED </span></span>
<span><span class="co">#&gt; Drawing a sample of size 1000 from the approximate posterior...  </span></span>
<span><span class="co">#&gt; COMPLETED. </span></span>
<span><span class="co">#&gt; Finished in  16.5 seconds.</span></span></code></pre>
<p>These modified models can be used to simulate synthetic null data
that help contextualize the effects seen in real data. For example, we
can compare imaginary cohort drawn from the original and the altered
models. Notice that I re-assigned all the treatments. This removes
potential confounding between the treatment and subject level effects –
this effect doesn’t exist on average across the population because the
study was randomized, but we want to remove any associations present in
our finite sample.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_assign</span> <span class="op">&lt;-</span> <span class="va">exper</span><span class="op">@</span><span class="va">treatments</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">exper</span><span class="op">@</span><span class="va">treatments</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">profile</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_profile.html">setup_profile</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">new_assign</span>, <span class="va">new_assign</span><span class="op">)</span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">model</span>, profile <span class="op">=</span> <span class="va">profile</span>, pretreatment <span class="op">=</span> <span class="va">exper</span><span class="op">@</span><span class="va">pretreatments</span><span class="op">)</span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">altered</span>, profile <span class="op">=</span> <span class="va">profile</span>, pretreatment <span class="op">=</span> <span class="va">exper</span><span class="op">@</span><span class="va">pretreatments</span><span class="op">)</span></span></code></pre></div>
<p>The sampled objects above have the same class as <code>exper</code>.
We can extract the real and simulated mediator data to see the treatment
effects along those edges. As expected, the altered model has no
systematic difference between treatment groups. This lends some evidence
to the conclusion that mindfulness does influence the mediators, which
was implicit in our discussion of indirect effects above.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  real <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">exper</span><span class="op">@</span><span class="va">treatments</span>, <span class="va">exper</span><span class="op">@</span><span class="va">mediators</span>, <span class="va">exper</span><span class="op">@</span><span class="va">pretreatments</span><span class="op">)</span>,</span>
<span>  original <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">new_assign</span>, <span class="va">m1</span><span class="op">@</span><span class="va">mediators</span>, <span class="va">exper</span><span class="op">@</span><span class="va">pretreatments</span><span class="op">)</span>,</span>
<span>  altered <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">new_assign</span>, <span class="va">m2</span><span class="op">@</span><span class="va">mediators</span>, <span class="va">exper</span><span class="op">@</span><span class="va">pretreatments</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"source"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"mediator"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"mediator"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">value</span>, <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">mediator</span>, <span class="va">value</span>, <span class="va">median</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">source</span><span class="op">)</span></span></code></pre></div>
<p><img src="mindfulness_files/figure-html/synthetic_mediation_plot-1.png" width="600" style="display: block; margin: auto;"></p>
<p>Here is the analogous alteration that removes all direct effects. The
<span class="math inline">\(x\)</span>-axis is on a log scale, and the
LNM’s estimated treatment effects for rare taxa are not practically
significant. It’s interesting that even though the original data don’t
show much difference between treatment groups, the model suggests that
there are real effects, even for the abundant taxa. It’s possible that,
in the raw boxplots, heterogeneity across subjects and mediators masks
true effects, and the LNM is able to detect these effects by
appropriately accounting for sources of heterogeneity.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">altered_direct</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/nullify.html">nullify</a></span><span class="op">(</span><span class="st">"T-&gt;Y"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/estimate.html">estimate</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; EXPERIMENTAL ALGORITHM: </span></span>
<span><span class="co">#&gt;   This procedure has not been thoroughly tested and may be unstable </span></span>
<span><span class="co">#&gt;   or buggy. The interface is subject to change. </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; Gradient evaluation took 0.007752 seconds </span></span>
<span><span class="co">#&gt; 1000 transitions using 10 leapfrog steps per transition would take 77.52 seconds. </span></span>
<span><span class="co">#&gt; Adjust your expectations accordingly! </span></span>
<span><span class="co">#&gt; Begin eta adaptation. </span></span>
<span><span class="co">#&gt; Iteration:   1 / 250 [  0%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration:  50 / 250 [ 20%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 100 / 250 [ 40%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 150 / 250 [ 60%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 200 / 250 [ 80%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Success! Found best value [eta = 1] earlier than expected. </span></span>
<span><span class="co">#&gt; Begin stochastic gradient ascent. </span></span>
<span><span class="co">#&gt;   iter             ELBO   delta_ELBO_mean   delta_ELBO_med   notes  </span></span>
<span><span class="co">#&gt;    100      -286918.019             1.000            1.000 </span></span>
<span><span class="co">#&gt;    200      -104917.320             1.367            1.735 </span></span>
<span><span class="co">#&gt;    300       -92595.460             0.956            1.000 </span></span>
<span><span class="co">#&gt;    400       -88954.112             0.727            1.000 </span></span>
<span><span class="co">#&gt;    500       -87383.372             0.585            0.133 </span></span>
<span><span class="co">#&gt;    600       -86258.965             0.490            0.133 </span></span>
<span><span class="co">#&gt;    700       -85569.685             0.421            0.041 </span></span>
<span><span class="co">#&gt;    800       -84971.656             0.369            0.041 </span></span>
<span><span class="co">#&gt;    900       -84708.412             0.329            0.018 </span></span>
<span><span class="co">#&gt;   1000       -84309.170             0.296            0.018 </span></span>
<span><span class="co">#&gt;   1100       -84071.410             0.197            0.013 </span></span>
<span><span class="co">#&gt;   1200       -83880.348             0.023            0.008   MEDIAN ELBO CONVERGED </span></span>
<span><span class="co">#&gt; Drawing a sample of size 1000 from the approximate posterior...  </span></span>
<span><span class="co">#&gt; COMPLETED. </span></span>
<span><span class="co">#&gt; Finished in  17.1 seconds.</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">altered_indirect</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/nullify.html">nullify</a></span><span class="op">(</span><span class="st">"M-&gt;Y"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/estimate.html">estimate</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; EXPERIMENTAL ALGORITHM: </span></span>
<span><span class="co">#&gt;   This procedure has not been thoroughly tested and may be unstable </span></span>
<span><span class="co">#&gt;   or buggy. The interface is subject to change. </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; Gradient evaluation took 0.007383 seconds </span></span>
<span><span class="co">#&gt; 1000 transitions using 10 leapfrog steps per transition would take 73.83 seconds. </span></span>
<span><span class="co">#&gt; Adjust your expectations accordingly! </span></span>
<span><span class="co">#&gt; Begin eta adaptation. </span></span>
<span><span class="co">#&gt; Iteration:   1 / 250 [  0%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration:  50 / 250 [ 20%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 100 / 250 [ 40%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 150 / 250 [ 60%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 200 / 250 [ 80%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Success! Found best value [eta = 1] earlier than expected. </span></span>
<span><span class="co">#&gt; Begin stochastic gradient ascent. </span></span>
<span><span class="co">#&gt;   iter             ELBO   delta_ELBO_mean   delta_ELBO_med   notes  </span></span>
<span><span class="co">#&gt;    100      -266185.924             1.000            1.000 </span></span>
<span><span class="co">#&gt;    200      -103322.121             1.288            1.576 </span></span>
<span><span class="co">#&gt;    300       -90720.935             0.905            1.000 </span></span>
<span><span class="co">#&gt;    400       -87659.862             0.688            1.000 </span></span>
<span><span class="co">#&gt;    500       -86393.749             0.553            0.139 </span></span>
<span><span class="co">#&gt;    600       -85556.774             0.462            0.139 </span></span>
<span><span class="co">#&gt;    700       -84583.951             0.398            0.035 </span></span>
<span><span class="co">#&gt;    800       -84086.834             0.349            0.035 </span></span>
<span><span class="co">#&gt;    900       -83825.808             0.311            0.015 </span></span>
<span><span class="co">#&gt;   1000       -83560.389             0.280            0.015 </span></span>
<span><span class="co">#&gt;   1100       -83420.529             0.180            0.012 </span></span>
<span><span class="co">#&gt;   1200       -83137.414             0.023            0.010   MEDIAN ELBO CONVERGED </span></span>
<span><span class="co">#&gt; Drawing a sample of size 1000 from the approximate posterior...  </span></span>
<span><span class="co">#&gt; COMPLETED. </span></span>
<span><span class="co">#&gt; Finished in  16.8 seconds.</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">profile</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_profile.html">setup_profile</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span><span class="op">@</span><span class="va">treatments</span>, <span class="va">exper</span><span class="op">@</span><span class="va">treatments</span><span class="op">)</span></span>
<span><span class="va">y1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">model</span>, profile <span class="op">=</span> <span class="va">profile</span>, pretreatment <span class="op">=</span> <span class="va">exper</span><span class="op">@</span><span class="va">pretreatments</span><span class="op">)</span></span>
<span><span class="va">y2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">altered_direct</span>, profile <span class="op">=</span> <span class="va">profile</span>, pretreatment <span class="op">=</span> <span class="va">exper</span><span class="op">@</span><span class="va">pretreatments</span><span class="op">)</span></span>
<span><span class="va">y3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">altered_indirect</span>, profile <span class="op">=</span> <span class="va">profile</span>, pretreatment <span class="op">=</span> <span class="va">exper</span><span class="op">@</span><span class="va">pretreatments</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">taxa_order</span> <span class="op">&lt;-</span> <span class="fu">normalize</span><span class="op">(</span><span class="va">exper</span><span class="op">@</span><span class="va">outcomes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fl">2</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.infinite</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">combined_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Original Data"</span> <span class="op">=</span> <span class="fu">normalize</span><span class="op">(</span><span class="va">exper</span><span class="op">@</span><span class="va">outcomes</span><span class="op">)</span>,</span>
<span>  <span class="st">"Full Model"</span> <span class="op">=</span> <span class="fu">normalize</span><span class="op">(</span><span class="va">y1</span><span class="op">@</span><span class="va">outcomes</span><span class="op">)</span>,</span>
<span>  <span class="st">"No Direct Effect"</span> <span class="op">=</span> <span class="fu">normalize</span><span class="op">(</span><span class="va">y2</span><span class="op">@</span><span class="va">outcomes</span><span class="op">)</span>,</span>
<span>  <span class="st">"No Indirect Effect"</span> <span class="op">=</span> <span class="fu">normalize</span><span class="op">(</span><span class="va">y3</span><span class="op">@</span><span class="va">outcomes</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"source"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">exper</span><span class="op">@</span><span class="va">treatments</span><span class="op">$</span><span class="va">treatment</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">exper</span><span class="op">@</span><span class="va">outcomes</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">name</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">exper</span><span class="op">@</span><span class="va">outcomes</span><span class="op">)</span><span class="op">[</span><span class="va">taxa_order</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">combined_samples</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, <span class="va">name</span>, fill <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.4</span>, outlier.size <span class="op">=</span> <span class="fl">0.8</span>, position <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.7</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log(Relative Abundance)"</span>, y <span class="op">=</span> <span class="st">"Genus"</span>, fill <span class="op">=</span> <span class="st">""</span>, col <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">source</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="mindfulness_files/figure-html/alteration_plot-1.png" width="600" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combined_samples</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">source</span>, <span class="va">treatment</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>presence <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">value</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">presence</span>, <span class="va">name</span>, fill <span class="op">=</span> <span class="va">treatment</span>, col <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span>, width <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.7</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">source</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="mindfulness_files/figure-html/alteration_presence-1.png" width="600" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="synthetic-null-testing">Synthetic Null Testing<a class="anchor" aria-label="anchor" href="#synthetic-null-testing"></a>
</h2>
<p>A standard approach to inference is to apply a bootstrap (this is
done at the end of the vignette). An alternative, which is less common,
but well-suited to high-dimensions is to calibrate variable selection
sets using synthetic null data. For example, this is the intuition
behind the knockoff, Clipper, and mirror statistic algorithms. The
general recipe is:</p>
<ol style="list-style-type: decimal">
<li>Simulate synthetic null data from a model/sampling mechanism where
we know for certain that an effect does not exist.</li>
<li>Use the full model to estimate effects on this synthetic null
data.</li>
<li>Define a selection rule so that the fraction of selected synthetic
null effects is kept below an false discovery rate threshold.</li>
</ol>
<p>The synthetic null effects essentially serve as negative controls to
calibrate inference.</p>
<p>In <code>multimedia</code>, <code>null_contrast</code> estimates
effects on real and synthetic null data, while <code>fdr_summary</code>
ranks and selects features. Each point in the figure below is the
directed effect for a single feature in either real or synthetic data.
We rank features according to their absolute effect size, and as soon as
negative control features enter, we begin increasing the estimated false
discovery rate for the rule that selects features up to that point.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contrast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/null_contrast.html">null_contrast</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span>, <span class="st">"T-&gt;Y"</span>, <span class="va">direct_effect</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; EXPERIMENTAL ALGORITHM: </span></span>
<span><span class="co">#&gt;   This procedure has not been thoroughly tested and may be unstable </span></span>
<span><span class="co">#&gt;   or buggy. The interface is subject to change. </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; Gradient evaluation took 0.007991 seconds </span></span>
<span><span class="co">#&gt; 1000 transitions using 10 leapfrog steps per transition would take 79.91 seconds. </span></span>
<span><span class="co">#&gt; Adjust your expectations accordingly! </span></span>
<span><span class="co">#&gt; Begin eta adaptation. </span></span>
<span><span class="co">#&gt; Iteration:   1 / 250 [  0%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration:  50 / 250 [ 20%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 100 / 250 [ 40%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 150 / 250 [ 60%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 200 / 250 [ 80%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Success! Found best value [eta = 1] earlier than expected. </span></span>
<span><span class="co">#&gt; Begin stochastic gradient ascent. </span></span>
<span><span class="co">#&gt;   iter             ELBO   delta_ELBO_mean   delta_ELBO_med   notes  </span></span>
<span><span class="co">#&gt;    100      -286918.019             1.000            1.000 </span></span>
<span><span class="co">#&gt;    200      -104917.320             1.367            1.735 </span></span>
<span><span class="co">#&gt;    300       -92595.460             0.956            1.000 </span></span>
<span><span class="co">#&gt;    400       -88954.112             0.727            1.000 </span></span>
<span><span class="co">#&gt;    500       -87383.372             0.585            0.133 </span></span>
<span><span class="co">#&gt;    600       -86258.965             0.490            0.133 </span></span>
<span><span class="co">#&gt;    700       -85569.685             0.421            0.041 </span></span>
<span><span class="co">#&gt;    800       -84971.656             0.369            0.041 </span></span>
<span><span class="co">#&gt;    900       -84708.412             0.329            0.018 </span></span>
<span><span class="co">#&gt;   1000       -84309.170             0.296            0.018 </span></span>
<span><span class="co">#&gt;   1100       -84071.410             0.197            0.013 </span></span>
<span><span class="co">#&gt;   1200       -83880.348             0.023            0.008   MEDIAN ELBO CONVERGED </span></span>
<span><span class="co">#&gt; Drawing a sample of size 1000 from the approximate posterior...  </span></span>
<span><span class="co">#&gt; COMPLETED. </span></span>
<span><span class="co">#&gt; Finished in  19.0 seconds.</span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; EXPERIMENTAL ALGORITHM: </span></span>
<span><span class="co">#&gt;   This procedure has not been thoroughly tested and may be unstable </span></span>
<span><span class="co">#&gt;   or buggy. The interface is subject to change. </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; Gradient evaluation took 0.008081 seconds </span></span>
<span><span class="co">#&gt; 1000 transitions using 10 leapfrog steps per transition would take 80.81 seconds. </span></span>
<span><span class="co">#&gt; Adjust your expectations accordingly! </span></span>
<span><span class="co">#&gt; Begin eta adaptation. </span></span>
<span><span class="co">#&gt; Iteration:   1 / 250 [  0%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration:  50 / 250 [ 20%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 100 / 250 [ 40%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 150 / 250 [ 60%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 200 / 250 [ 80%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Success! Found best value [eta = 1] earlier than expected. </span></span>
<span><span class="co">#&gt; Begin stochastic gradient ascent. </span></span>
<span><span class="co">#&gt;   iter             ELBO   delta_ELBO_mean   delta_ELBO_med   notes  </span></span>
<span><span class="co">#&gt;    100      -398156.198             1.000            1.000 </span></span>
<span><span class="co">#&gt;    200      -127057.972             1.567            2.134 </span></span>
<span><span class="co">#&gt;    300      -103331.698             1.121            1.000 </span></span>
<span><span class="co">#&gt;    400       -99333.193             0.851            1.000 </span></span>
<span><span class="co">#&gt;    500       -97451.702             0.685            0.230 </span></span>
<span><span class="co">#&gt;    600       -96463.899             0.572            0.230 </span></span>
<span><span class="co">#&gt;    700       -95283.255             0.492            0.040 </span></span>
<span><span class="co">#&gt;    800       -94920.063             0.431            0.040 </span></span>
<span><span class="co">#&gt;    900       -94538.883             0.384            0.019 </span></span>
<span><span class="co">#&gt;   1000       -94191.096             0.346            0.019 </span></span>
<span><span class="co">#&gt;   1100       -93854.391             0.246            0.012 </span></span>
<span><span class="co">#&gt;   1200       -93567.727             0.033            0.010 </span></span>
<span><span class="co">#&gt;   1300       -93377.218             0.010            0.004   MEDIAN ELBO CONVERGED </span></span>
<span><span class="co">#&gt; Drawing a sample of size 1000 from the approximate posterior...  </span></span>
<span><span class="co">#&gt; COMPLETED. </span></span>
<span><span class="co">#&gt; Finished in  19.1 seconds.</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fdr_direct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdr_summary.html">fdr_summary</a></span><span class="op">(</span><span class="va">contrast</span>, <span class="st">"direct_effect"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>effect <span class="op">=</span> <span class="va">direct_effect</span><span class="op">)</span></span></code></pre></div>
<p>The indirect effect analog is shown below. It seems we have more
evidence for direct than indirect effects. This is consistent with
literature on the difficulty of estimating indirect effects in mediation
analysis.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contrast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/null_contrast.html">null_contrast</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span>, <span class="st">"M-&gt;Y"</span>, <span class="va">indirect_overall</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; EXPERIMENTAL ALGORITHM: </span></span>
<span><span class="co">#&gt;   This procedure has not been thoroughly tested and may be unstable </span></span>
<span><span class="co">#&gt;   or buggy. The interface is subject to change. </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; Gradient evaluation took 0.008019 seconds </span></span>
<span><span class="co">#&gt; 1000 transitions using 10 leapfrog steps per transition would take 80.19 seconds. </span></span>
<span><span class="co">#&gt; Adjust your expectations accordingly! </span></span>
<span><span class="co">#&gt; Begin eta adaptation. </span></span>
<span><span class="co">#&gt; Iteration:   1 / 250 [  0%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration:  50 / 250 [ 20%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 100 / 250 [ 40%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 150 / 250 [ 60%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 200 / 250 [ 80%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Success! Found best value [eta = 1] earlier than expected. </span></span>
<span><span class="co">#&gt; Begin stochastic gradient ascent. </span></span>
<span><span class="co">#&gt;   iter             ELBO   delta_ELBO_mean   delta_ELBO_med   notes  </span></span>
<span><span class="co">#&gt;    100      -266185.924             1.000            1.000 </span></span>
<span><span class="co">#&gt;    200      -103322.121             1.288            1.576 </span></span>
<span><span class="co">#&gt;    300       -90720.935             0.905            1.000 </span></span>
<span><span class="co">#&gt;    400       -87659.862             0.688            1.000 </span></span>
<span><span class="co">#&gt;    500       -86393.749             0.553            0.139 </span></span>
<span><span class="co">#&gt;    600       -85556.774             0.462            0.139 </span></span>
<span><span class="co">#&gt;    700       -84583.951             0.398            0.035 </span></span>
<span><span class="co">#&gt;    800       -84086.834             0.349            0.035 </span></span>
<span><span class="co">#&gt;    900       -83825.808             0.311            0.015 </span></span>
<span><span class="co">#&gt;   1000       -83560.389             0.280            0.015 </span></span>
<span><span class="co">#&gt;   1100       -83420.529             0.180            0.012 </span></span>
<span><span class="co">#&gt;   1200       -83137.414             0.023            0.010   MEDIAN ELBO CONVERGED </span></span>
<span><span class="co">#&gt; Drawing a sample of size 1000 from the approximate posterior...  </span></span>
<span><span class="co">#&gt; COMPLETED. </span></span>
<span><span class="co">#&gt; Finished in  17.9 seconds.</span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; EXPERIMENTAL ALGORITHM: </span></span>
<span><span class="co">#&gt;   This procedure has not been thoroughly tested and may be unstable </span></span>
<span><span class="co">#&gt;   or buggy. The interface is subject to change. </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; Gradient evaluation took 0.008208 seconds </span></span>
<span><span class="co">#&gt; 1000 transitions using 10 leapfrog steps per transition would take 82.08 seconds. </span></span>
<span><span class="co">#&gt; Adjust your expectations accordingly! </span></span>
<span><span class="co">#&gt; Begin eta adaptation. </span></span>
<span><span class="co">#&gt; Iteration:   1 / 250 [  0%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration:  50 / 250 [ 20%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 100 / 250 [ 40%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 150 / 250 [ 60%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 200 / 250 [ 80%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Success! Found best value [eta = 1] earlier than expected. </span></span>
<span><span class="co">#&gt; Begin stochastic gradient ascent. </span></span>
<span><span class="co">#&gt;   iter             ELBO   delta_ELBO_mean   delta_ELBO_med   notes  </span></span>
<span><span class="co">#&gt;    100      -403718.462             1.000            1.000 </span></span>
<span><span class="co">#&gt;    200      -123099.460             1.640            2.280 </span></span>
<span><span class="co">#&gt;    300      -103851.932             1.155            1.000 </span></span>
<span><span class="co">#&gt;    400       -99382.762             0.877            1.000 </span></span>
<span><span class="co">#&gt;    500       -97183.696             0.707            0.185 </span></span>
<span><span class="co">#&gt;    600       -95845.002             0.591            0.185 </span></span>
<span><span class="co">#&gt;    700       -95157.277             0.508            0.045 </span></span>
<span><span class="co">#&gt;    800       -94429.131             0.445            0.045 </span></span>
<span><span class="co">#&gt;    900       -94167.993             0.396            0.023 </span></span>
<span><span class="co">#&gt;   1000       -93834.500             0.357            0.023 </span></span>
<span><span class="co">#&gt;   1100       -93335.581             0.257            0.014 </span></span>
<span><span class="co">#&gt;   1200       -93186.795             0.030            0.008   MEDIAN ELBO CONVERGED </span></span>
<span><span class="co">#&gt; Drawing a sample of size 1000 from the approximate posterior...  </span></span>
<span><span class="co">#&gt; COMPLETED. </span></span>
<span><span class="co">#&gt; Finished in  18.0 seconds.</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fdr_indirect</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdr_summary.html">fdr_summary</a></span><span class="op">(</span><span class="va">contrast</span>, <span class="st">"indirect_overall"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>effect <span class="op">=</span> <span class="va">indirect_effect</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fdr_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">fdr_direct</span>, <span class="va">fdr_indirect</span>, .id <span class="op">=</span> <span class="st">"effect_type"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>effect_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Direct"</span>, <span class="st">"Indirect"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">effect_type</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fdr_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">effect</span>, <span class="va">fdr_hat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">fdr_data</span>, <span class="va">keep</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">outcome</span>, fill <span class="op">=</span> <span class="va">source</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span>, force <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Effect"</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">widehat</span><span class="op">(</span><span class="va">FDR</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"Data Source"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">source</span>, size <span class="op">=</span> <span class="va">keep</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_discrete</a></span><span class="op">(</span><span class="st">"Selected"</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">3</span><span class="op">)</span>, guide <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.55</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">effect_type</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>    strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="mindfulness_files/figure-html/contrast_plot-1.png" width="600" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bind_mediation.html">bind_mediation</a></span><span class="op">(</span><span class="va">exper_rela</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"mediator"</span><span class="op">)</span>, <span class="va">treatment</span>, <span class="va">Roseburia</span>, <span class="va">Blautia</span>, <span class="va">Faecalibacterium</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"mediator"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"mediator"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mediator <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="va">mediator</span>, <span class="st">"mediator."</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">Roseburia</span><span class="op">:</span><span class="va">Faecalibacterium</span>, names_to <span class="op">=</span> <span class="st">"taxon"</span>, values_to <span class="op">=</span> <span class="st">"abundance"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">mediator</span>, <span class="va">treatment</span>, <span class="va">taxon</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>abundance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">)</span>, value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">value</span>, <span class="va">abundance</span>, col <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">taxon</span> <span class="op">~</span> <span class="va">mediator</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Relative Abundance"</span>, x <span class="op">=</span> <span class="st">"Mediator Value"</span>, col <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,</span>
<span>    strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>    strip.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>    panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="mindfulness_files/figure-html/unnamed-chunk-1-1.png" width="600" style="display: block; margin: auto;"></p>
<p>Here is the analog for indirect pathwise effects. Since these effects
distinguish between individual mediators, we can facet by these
variables.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contrast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/null_contrast.html">null_contrast</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span>, <span class="st">"M-&gt;Y"</span>, <span class="va">indirect_pathwise</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; EXPERIMENTAL ALGORITHM: </span></span>
<span><span class="co">#&gt;   This procedure has not been thoroughly tested and may be unstable </span></span>
<span><span class="co">#&gt;   or buggy. The interface is subject to change. </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; Gradient evaluation took 0.00786 seconds </span></span>
<span><span class="co">#&gt; 1000 transitions using 10 leapfrog steps per transition would take 78.6 seconds. </span></span>
<span><span class="co">#&gt; Adjust your expectations accordingly! </span></span>
<span><span class="co">#&gt; Begin eta adaptation. </span></span>
<span><span class="co">#&gt; Iteration:   1 / 250 [  0%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration:  50 / 250 [ 20%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 100 / 250 [ 40%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 150 / 250 [ 60%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 200 / 250 [ 80%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Success! Found best value [eta = 1] earlier than expected. </span></span>
<span><span class="co">#&gt; Begin stochastic gradient ascent. </span></span>
<span><span class="co">#&gt;   iter             ELBO   delta_ELBO_mean   delta_ELBO_med   notes  </span></span>
<span><span class="co">#&gt;    100      -266185.924             1.000            1.000 </span></span>
<span><span class="co">#&gt;    200      -103322.121             1.288            1.576 </span></span>
<span><span class="co">#&gt;    300       -90720.935             0.905            1.000 </span></span>
<span><span class="co">#&gt;    400       -87659.862             0.688            1.000 </span></span>
<span><span class="co">#&gt;    500       -86393.749             0.553            0.139 </span></span>
<span><span class="co">#&gt;    600       -85556.774             0.462            0.139 </span></span>
<span><span class="co">#&gt;    700       -84583.951             0.398            0.035 </span></span>
<span><span class="co">#&gt;    800       -84086.834             0.349            0.035 </span></span>
<span><span class="co">#&gt;    900       -83825.808             0.311            0.015 </span></span>
<span><span class="co">#&gt;   1000       -83560.389             0.280            0.015 </span></span>
<span><span class="co">#&gt;   1100       -83420.529             0.180            0.012 </span></span>
<span><span class="co">#&gt;   1200       -83137.414             0.023            0.010   MEDIAN ELBO CONVERGED </span></span>
<span><span class="co">#&gt; Drawing a sample of size 1000 from the approximate posterior...  </span></span>
<span><span class="co">#&gt; COMPLETED. </span></span>
<span><span class="co">#&gt; Finished in  17.4 seconds.</span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; EXPERIMENTAL ALGORITHM: </span></span>
<span><span class="co">#&gt;   This procedure has not been thoroughly tested and may be unstable </span></span>
<span><span class="co">#&gt;   or buggy. The interface is subject to change. </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; Gradient evaluation took 0.008226 seconds </span></span>
<span><span class="co">#&gt; 1000 transitions using 10 leapfrog steps per transition would take 82.26 seconds. </span></span>
<span><span class="co">#&gt; Adjust your expectations accordingly! </span></span>
<span><span class="co">#&gt; Begin eta adaptation. </span></span>
<span><span class="co">#&gt; Iteration:   1 / 250 [  0%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration:  50 / 250 [ 20%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 100 / 250 [ 40%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 150 / 250 [ 60%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Iteration: 200 / 250 [ 80%]  (Adaptation) </span></span>
<span><span class="co">#&gt; Success! Found best value [eta = 1] earlier than expected. </span></span>
<span><span class="co">#&gt; Begin stochastic gradient ascent. </span></span>
<span><span class="co">#&gt;   iter             ELBO   delta_ELBO_mean   delta_ELBO_med   notes  </span></span>
<span><span class="co">#&gt;    100      -404953.136             1.000            1.000 </span></span>
<span><span class="co">#&gt;    200      -125727.722             1.610            2.221 </span></span>
<span><span class="co">#&gt;    300      -103861.665             1.144            1.000 </span></span>
<span><span class="co">#&gt;    400       -99594.088             0.869            1.000 </span></span>
<span><span class="co">#&gt;    500       -97780.353             0.699            0.211 </span></span>
<span><span class="co">#&gt;    600       -96648.299             0.584            0.211 </span></span>
<span><span class="co">#&gt;    700       -95802.992             0.502            0.043 </span></span>
<span><span class="co">#&gt;    800       -95160.279             0.440            0.043 </span></span>
<span><span class="co">#&gt;    900       -94773.858             0.392            0.019 </span></span>
<span><span class="co">#&gt;   1000       -94306.141             0.353            0.019 </span></span>
<span><span class="co">#&gt;   1100       -94069.677             0.253            0.012 </span></span>
<span><span class="co">#&gt;   1200       -93725.424             0.031            0.009   MEDIAN ELBO CONVERGED </span></span>
<span><span class="co">#&gt; Drawing a sample of size 1000 from the approximate posterior...  </span></span>
<span><span class="co">#&gt; COMPLETED. </span></span>
<span><span class="co">#&gt; Finished in  17.9 seconds.</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fdr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdr_summary.html">fdr_summary</a></span><span class="op">(</span><span class="va">contrast</span>, <span class="st">"indirect_pathwise"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fdr</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">indirect_effect</span>, <span class="va">fdr_hat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">fdr</span>, <span class="va">keep</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">outcome</span>, fill <span class="op">=</span> <span class="va">source</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Indirect Effect"</span>, y <span class="op">=</span> <span class="st">"Estimated False Discovery Rate"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">source</span>, size <span class="op">=</span> <span class="va">keep</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_discrete</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">mediator</span><span class="op">)</span></span></code></pre></div>
<p><img src="mindfulness_files/figure-html/indirect_pathwise_contrast-1.png" width="600" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="random-forests">Random Forests<a class="anchor" aria-label="anchor" href="#random-forests"></a>
</h2>
<p>The LNM makes relatively strong assumptions on the outcome model: The
effects must enter linearly through a multinomial likelihood. As a
nonparametric alternative, we can fit separate random forest models to
each microbe’s abundance. Since this model doesn’t directly account for
compositions, it will help to transform the response to relative
abundances.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multimedia.html">multimedia</a></span><span class="op">(</span></span>
<span>  <span class="va">exper_rela</span>,</span>
<span>  <span class="fu"><a href="../reference/rf_model.html">rf_model</a></span><span class="op">(</span>num.trees <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/glmnet_model.html">glmnet_model</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/estimate.html">estimate</a></span><span class="op">(</span><span class="va">exper_rela</span><span class="op">)</span></span></code></pre></div>
<p>We can compute direct and indirect effects from the estimated
model.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">direct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/direct_effect.html">direct_effect</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper_rela</span><span class="op">)</span></span>
<span><span class="va">direct_sorted</span> <span class="op">&lt;-</span> <span class="va">direct</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="va">contrast</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>direct_effect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">direct_effect</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">direct_effect</span><span class="op">)</span></span>
<span></span>
<span><span class="va">indirect_sorted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/indirect_pathwise.html">indirect_pathwise</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper_rela</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="va">mediator</span>, <span class="va">contrast</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>indirect_effect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">indirect_effect</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">indirect_effect</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">direct_sorted</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; # A tibble: 55 × 3</span></span>
<span><span class="co">#&gt; # Groups:   outcome [55]</span></span>
<span><span class="co">#&gt;    outcome           contrast            direct_effect</span></span>
<span><span class="co">#&gt;                                       </span></span>
<span><span class="co">#&gt;  1 Ruminococcus      Control - Treatment      0.00479 </span></span>
<span><span class="co">#&gt;  2 Faecalibacterium  Control - Treatment      0.00418 </span></span>
<span><span class="co">#&gt;  3 Roseburia         Control - Treatment      0.00329 </span></span>
<span><span class="co">#&gt;  4 Parabacteroides   Control - Treatment      0.00129 </span></span>
<span><span class="co">#&gt;  5 Coprococcus       Control - Treatment      0.00125 </span></span>
<span><span class="co">#&gt;  6 Streptococcus     Control - Treatment      0.000515</span></span>
<span><span class="co">#&gt;  7 Dorea             Control - Treatment      0.000503</span></span>
<span><span class="co">#&gt;  8 Clostridium_XVIII Control - Treatment      0.000488</span></span>
<span><span class="co">#&gt;  9 Clostridium_XlVa  Control - Treatment      0.000148</span></span>
<span><span class="co">#&gt; 10 Butyricicoccus    Control - Treatment      0.000131</span></span>
<span><span class="co">#&gt; # ℹ 45 more rows</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">indirect_sorted</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; # A tibble: 220 × 4</span></span>
<span><span class="co">#&gt; # Groups:   outcome, mediator [220]</span></span>
<span><span class="co">#&gt;    outcome          mediator                    contrast         indirect_effect</span></span>
<span><span class="co">#&gt;                                                            </span></span>
<span><span class="co">#&gt;  1 Ruminococcus     mediator.Cold.cereal        Control - Treat…        -0.00988</span></span>
<span><span class="co">#&gt;  2 Blautia          mediator.sleepDistRaw       Control - Treat…         0.00765</span></span>
<span><span class="co">#&gt;  3 Clostridium_IV   mediator.Cold.cereal        Control - Treat…        -0.00552</span></span>
<span><span class="co">#&gt;  4 Prevotella       mediator.Fruit..not.juices. Control - Treat…        -0.00451</span></span>
<span><span class="co">#&gt;  5 Faecalibacterium mediator.Fruit..not.juices. Control - Treat…         0.00390</span></span>
<span><span class="co">#&gt;  6 Blautia          mediator.Cold.cereal        Control - Treat…         0.00383</span></span>
<span><span class="co">#&gt;  7 Faecalibacterium mediator.sleepDistRaw       Control - Treat…        -0.00370</span></span>
<span><span class="co">#&gt;  8 Bacteroides      mediator.fatigueRaw         Control - Treat…        -0.00313</span></span>
<span><span class="co">#&gt;  9 Prevotella       mediator.Cold.cereal        Control - Treat…         0.00313</span></span>
<span><span class="co">#&gt; 10 Prevotella       mediator.sleepDistRaw       Control - Treat…        -0.00307</span></span>
<span><span class="co">#&gt; # ℹ 210 more rows</span></span></code></pre>
<p>We can visualize some of the features with the largest direct and
indirect effects. Nonlinearity seems to have helped uncover a few
mediator to microbe relationships, for example, the relationships
between sleep disturbance/Ruminococcus2 and cereal/Faecalibacterium.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_mediators.html">plot_mediators</a></span><span class="op">(</span><span class="va">indirect_sorted</span>, <span class="va">exper_rela</span><span class="op">)</span></span></code></pre></div>
<p><img src="mindfulness_files/figure-html/rf_mediation_plots-1.png" width="600" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="bootstrap">Bootstrap<a class="anchor" aria-label="anchor" href="#bootstrap"></a>
</h2>
<p>The bootstrap can help evaluate uncertainty for more complex
statistics, and it’s a good option for our random forest analysis. In
each iteration, we randomly subsample timepoints from the original
experiment and compute a list of estimates, specified by the list
<code>funs</code> below. The output concatenates output across all
bootstrap iterations.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">funs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>direct <span class="op">=</span> <span class="va">direct_effect</span>, indirect <span class="op">=</span> <span class="va">indirect_overall</span><span class="op">)</span></span>
<span><span class="va">inference</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bootstrap.html">bootstrap</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper_rela</span>, <span class="va">funs</span>, B <span class="op">=</span> <span class="fl">1e3</span><span class="op">)</span></span></code></pre></div>
<p>We can now visualize the bootstrap confidence intervals associated
with the estimated effects. The largest interval corresponds to a 90%
bootstrap confidence interval. The inner interval covers the median +/-
one-third of the bootstrap distribution’s mass. Some associations
certainly seem worth following up on, though more data will be needed
for validation.</p>
<p>Notice that the direct effects seem generally stronger than indirect
effects. Even with a flexible random forest model, it seems that changes
in diet and sleep alone are not enough to explain the changes in
microbiome composition seen in this study. This suggests that mechanisms
related to the gut-brain axis may be at play, lying behind the observed
direct effects.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">inference</span><span class="op">$</span><span class="va">indirect</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_slabinterval.html" class="external-link">stat_slabinterval</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">indirect_effect</span>, <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="va">indirect_effect</span>, <span class="va">median</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    .width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.66</span>, <span class="fl">.95</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Indirect Effects"</span>, y <span class="op">=</span> <span class="st">"Taxon"</span>, x <span class="op">=</span> <span class="st">"Effect (Rel. Abund Scale)"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">inference</span><span class="op">$</span><span class="va">direct</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_slabinterval.html" class="external-link">stat_slabinterval</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">direct_effect</span>, <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="va">direct_effect</span>, <span class="va">median</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    .width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.66</span>, <span class="fl">.95</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Direct Effects"</span>, y <span class="op">=</span> <span class="st">"Taxon"</span>, x <span class="op">=</span> <span class="st">"Effect (Rel. Abund Scale)"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">|</span> <span class="va">p2</span></span></code></pre></div>
<p><img src="mindfulness_files/figure-html/rf_bootstrap_figures-1.png" width="600" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Kris Sankaran.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
