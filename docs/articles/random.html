<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quick Start with Random Data • multimedia</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Quick Start with Random Data">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">multimedia</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/IBD.html">Microbiome - Metabolome Mediation Analysis</a>
    </li>
    <li>
      <a href="../articles/illustration.html">Illustration with Nonlinear Effects</a>
    </li>
    <li>
      <a href="../articles/mindfulness.html">The Mindfulness Study</a>
    </li>
    <li>
      <a href="../articles/random.html">Quick Start with Random Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/krisrs1128/multimedia/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Quick Start with Random Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/krisrs1128/multimedia/blob/HEAD/vignettes/random.Rmd" class="external-link"><code>vignettes/random.Rmd</code></a></small>
      <div class="hidden name"><code>random.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://krisrs1128.github.io/multimedia" class="external-link">multimedia</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggraph.data-imaginist.com" class="external-link">ggraph</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette gives a brief introduction using simulated that
resemble a mediation analysis of the gut-brain axis. The basic question
is – we know that meditation can reduce depression and anxiety symptoms,
so is it possible that microbiome shifts might play a role? In the
language of mediation analysis, does the microbiome mediate Public
Health Questionnaire-9 (PHQ) score?</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/demo_joy.html">demo_joy</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; class: SummarizedExperiment </span></span>
<span><span class="co">#&gt; dim: 5 100 </span></span>
<span><span class="co">#&gt; metadata(0):</span></span>
<span><span class="co">#&gt; assays(1): counts</span></span>
<span><span class="co">#&gt; rownames(5): ASV1 ASV2 ASV3 ASV4 ASV5</span></span>
<span><span class="co">#&gt; rowData names(0):</span></span>
<span><span class="co">#&gt; colnames: NULL</span></span>
<span><span class="co">#&gt; colData names(2): treatment PHQ</span></span></code></pre>
<p>For mediation analysis, we distinguish between the different variable
types. This data structures defines treatment, mediator, and outcome
group using tidyselect-style notation.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exper</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mediation_data.html">mediation_data</a></span><span class="op">(</span><span class="fu"><a href="../reference/demo_joy.html">demo_joy</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"PHQ"</span>, <span class="st">"treatment"</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"ASV"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">exper</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; [Mediation Data] </span></span>
<span><span class="co">#&gt; 100 samples with measurements for, </span></span>
<span><span class="co">#&gt; 1 treatment: treatment </span></span>
<span><span class="co">#&gt; 5 mediators: ASV1, ASV2, ... </span></span>
<span><span class="co">#&gt; 1 outcome: PHQ</span></span></code></pre>
<p>This is the main estimation function. By default, we fit a separate
linear regression model for each mediation and outcome variable.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multimedia.html">multimedia</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/estimate.html">estimate</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; [Multimedia Analysis] </span></span>
<span><span class="co">#&gt; Treatments: treatment </span></span>
<span><span class="co">#&gt; Outcomes: PHQ </span></span>
<span><span class="co">#&gt; Mediators: ASV1, ASV2, ... </span></span>
<span><span class="co">#&gt;   </span></span>
<span><span class="co">#&gt; [Models] </span></span>
<span><span class="co">#&gt; mediation: A fitted lm_model(). </span></span>
<span><span class="co">#&gt; outcome: A fitted lm_model().</span></span></code></pre>
<p>The <code>edges</code> slot tracks all the variable relationships,
and it can be accessed using the <code>edges</code> method. For example,
we can visualize the causal graph using the <code>ggraph</code> code
below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="fu">edges</span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html" class="external-link">geom_edge_link</a></span><span class="op">(</span>arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_text.html" class="external-link">geom_node_label</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">name</span>, fill <span class="op">=</span> <span class="va">node_type</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="random_files/figure-html/graph-1.png" width="600" style="display: block; margin: auto;"></p>
<p>Now that we’ve coupled the mediation and outcome models, we can
propogate predictions and samples through them. That is, we can define
certain configurations of the treatment (and pretreatments, if we have
them) and then use the fitted models to simulate new mediation and
outcome samples. By default, it will sample at the template data that
was used to fit the model, just like the <code>predict</code> method for
<code>lm</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; [Mediation Data] </span></span>
<span><span class="co">#&gt; 2 samples with measurements for, </span></span>
<span><span class="co">#&gt; 1 treatment: treatment </span></span>
<span><span class="co">#&gt; 5 mediators: ASV1, ASV2, ... </span></span>
<span><span class="co">#&gt; 1 outcome: PHQ</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; $mediators</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 5</span></span>
<span><span class="co">#&gt;     ASV1   ASV2   ASV3    ASV4   ASV5</span></span>
<span><span class="co">#&gt;             </span></span>
<span><span class="co">#&gt; 1 0.0733 -0.356 0.0738 -0.244  -0.180</span></span>
<span><span class="co">#&gt; 2 0.0336  0.207 0.216  -0.0296 -0.241</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $outcomes</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 1</span></span>
<span><span class="co">#&gt;       PHQ</span></span>
<span><span class="co">#&gt;     </span></span>
<span><span class="co">#&gt; 1 -0.129 </span></span>
<span><span class="co">#&gt; 2 -0.0472</span></span></code></pre>
<p>Things get more interesting when we sample at new treatment and
pretreatment configurations. We need to be careful with our accounting,
because we want the flexibility to provide different combinations of
treatments to different sets of edges. For example, we may want to
imagine that the edge for one particular mediator was set to treatment
while all others were left at control. The example below has one sample
with this kind of configuration and three others that keep all edges at
control.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t_mediator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Treatment"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">t_outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="fl">4</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Treatment"</span>, <span class="st">"Control"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">profile</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_profile.html">setup_profile</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">t_mediator</span>, <span class="va">t_outcome</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">model</span>, profile <span class="op">=</span> <span class="va">profile</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; [Mediation Data] </span></span>
<span><span class="co">#&gt; 4 samples with measurements for, </span></span>
<span><span class="co">#&gt; 1 treatment: treatment </span></span>
<span><span class="co">#&gt; 5 mediators: ASV1, ASV2, ... </span></span>
<span><span class="co">#&gt; 1 outcome: PHQ</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, profile <span class="op">=</span> <span class="va">profile</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; $mediators</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 5</span></span>
<span><span class="co">#&gt;     ASV1   ASV2   ASV3    ASV4   ASV5</span></span>
<span><span class="co">#&gt;             </span></span>
<span><span class="co">#&gt; 1 0.0336  0.207 0.216  -0.0296 -0.241</span></span>
<span><span class="co">#&gt; 2 0.0733 -0.356 0.0738 -0.244  -0.180</span></span>
<span><span class="co">#&gt; 3 0.0733 -0.356 0.0738 -0.244  -0.180</span></span>
<span><span class="co">#&gt; 4 0.0733 -0.356 0.0738 -0.244  -0.180</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $outcomes</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 1</span></span>
<span><span class="co">#&gt;      PHQ</span></span>
<span><span class="co">#&gt;    </span></span>
<span><span class="co">#&gt; 1 -0.134</span></span>
<span><span class="co">#&gt; 2 -0.129</span></span>
<span><span class="co">#&gt; 3 -0.129</span></span>
<span><span class="co">#&gt; 4 -0.129</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/setup_profile.html">setup_profile</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">t_mediator</span>, <span class="va">t_outcome</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; An object of class "treatment_profile"</span></span>
<span><span class="co">#&gt; Slot "t_mediator":</span></span>
<span><span class="co">#&gt; $ASV1</span></span>
<span><span class="co">#&gt;   treatment</span></span>
<span><span class="co">#&gt; 1 Treatment</span></span>
<span><span class="co">#&gt; 2   Control</span></span>
<span><span class="co">#&gt; 3   Control</span></span>
<span><span class="co">#&gt; 4   Control</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ASV2</span></span>
<span><span class="co">#&gt;   treatment</span></span>
<span><span class="co">#&gt; 1 Treatment</span></span>
<span><span class="co">#&gt; 2   Control</span></span>
<span><span class="co">#&gt; 3   Control</span></span>
<span><span class="co">#&gt; 4   Control</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ASV3</span></span>
<span><span class="co">#&gt;   treatment</span></span>
<span><span class="co">#&gt; 1 Treatment</span></span>
<span><span class="co">#&gt; 2   Control</span></span>
<span><span class="co">#&gt; 3   Control</span></span>
<span><span class="co">#&gt; 4   Control</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ASV4</span></span>
<span><span class="co">#&gt;   treatment</span></span>
<span><span class="co">#&gt; 1 Treatment</span></span>
<span><span class="co">#&gt; 2   Control</span></span>
<span><span class="co">#&gt; 3   Control</span></span>
<span><span class="co">#&gt; 4   Control</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ASV5</span></span>
<span><span class="co">#&gt;   treatment</span></span>
<span><span class="co">#&gt; 1 Treatment</span></span>
<span><span class="co">#&gt; 2   Control</span></span>
<span><span class="co">#&gt; 3   Control</span></span>
<span><span class="co">#&gt; 4   Control</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot "t_outcome":</span></span>
<span><span class="co">#&gt; $PHQ</span></span>
<span><span class="co">#&gt;   treatment</span></span>
<span><span class="co">#&gt; 1   Control</span></span>
<span><span class="co">#&gt; 2   Control</span></span>
<span><span class="co">#&gt; 3   Control</span></span>
<span><span class="co">#&gt; 4   Control</span></span></code></pre>
<p>We can also contrast the predictions and samples under different
profiles.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">profile_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_profile.html">setup_profile</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">t_outcome</span>, <span class="va">t_outcome</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/contrast_predictions.html">contrast_predictions</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">profile</span>, <span class="va">profile_control</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; $mediators</span></span>
<span><span class="co">#&gt;          ASV1      ASV2      ASV3      ASV4        ASV5</span></span>
<span><span class="co">#&gt; 1 -0.03966196 0.5628434 0.1422071 0.2142301 -0.06050224</span></span>
<span><span class="co">#&gt; 2  0.00000000 0.0000000 0.0000000 0.0000000  0.00000000</span></span>
<span><span class="co">#&gt; 3  0.00000000 0.0000000 0.0000000 0.0000000  0.00000000</span></span>
<span><span class="co">#&gt; 4  0.00000000 0.0000000 0.0000000 0.0000000  0.00000000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $outcomes</span></span>
<span><span class="co">#&gt;            PHQ</span></span>
<span><span class="co">#&gt; 1 -0.004711189</span></span>
<span><span class="co">#&gt; 2  0.000000000</span></span>
<span><span class="co">#&gt; 3  0.000000000</span></span>
<span><span class="co">#&gt; 4  0.000000000</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/contrast_samples.html">contrast_samples</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">profile</span>, <span class="va">profile_control</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; $mediators</span></span>
<span><span class="co">#&gt;         ASV1        ASV2       ASV3       ASV4       ASV5</span></span>
<span><span class="co">#&gt; 1 -0.5824589 -1.31174550 -1.1535975 -2.0415285  0.2491817</span></span>
<span><span class="co">#&gt; 2 -1.3890991 -0.09735162 -0.6391102  2.8177793 -2.1016418</span></span>
<span><span class="co">#&gt; 3  0.2027900  0.29022594 -1.2864539 -1.8812498 -0.4874635</span></span>
<span><span class="co">#&gt; 4 -2.9809633  0.28255206 -0.7501835  0.2447107 -2.1785355</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $outcomes</span></span>
<span><span class="co">#&gt;          PHQ</span></span>
<span><span class="co">#&gt; 1  0.9445916</span></span>
<span><span class="co">#&gt; 2  2.8118436</span></span>
<span><span class="co">#&gt; 3 -0.8467963</span></span>
<span><span class="co">#&gt; 4  0.7034690</span></span></code></pre>
<div class="section level2">
<h2 id="effect-estimates">Effect Estimates<a class="anchor" aria-label="anchor" href="#effect-estimates"></a>
</h2>
<p>It’s a small step from contrasting different configurations to asking
for the direct and indirect treatments effects. The direct effect is
defined as the average of
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>Y</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>M</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mi>′</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mover><mi>Y</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>M</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mi>′</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\hat{Y}\left(\hat{M}\left(t'\right), 1\right) -  
\hat{Y}\left(\hat{M}\left(t'\right), 0\right)
</annotation></semantics></math> across mediator treatment effects
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>′</mi></mrow><annotation encoding="application/x-tex">t'</annotation></semantics></math>.
The hats mean that we use the predicted values from the mediation and
outcome values. I’ve distinguished between “overall” and “pathwise”
indirect effects because we’re working with high-dimensional mediators.
In the overall effect, we toggle treatment/control status for incoming
edges to all mediators. In pathwise indirect effects, we toggle only the
treatment going into one mediator.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/direct_effect.html">direct_effect</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt;   outcome indirect_setting            contrast direct_effect</span></span>
<span><span class="co">#&gt; 1     PHQ          Control Control - Treatment   -0.08646108</span></span>
<span><span class="co">#&gt; 2     PHQ        Treatment Control - Treatment   -0.08646108</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/indirect_overall.html">indirect_overall</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt;   outcome direct_setting            contrast indirect_effect</span></span>
<span><span class="co">#&gt; 1     PHQ        Control Control - Treatment     0.004711189</span></span>
<span><span class="co">#&gt; 2     PHQ      Treatment Control - Treatment     0.004711189</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/indirect_pathwise.html">indirect_pathwise</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt;    outcome mediator direct_setting            contrast indirect_effect</span></span>
<span><span class="co">#&gt; 1      PHQ     ASV1        Control Control - Treatment     0.002020718</span></span>
<span><span class="co">#&gt; 2      PHQ     ASV2        Control Control - Treatment    -0.022797615</span></span>
<span><span class="co">#&gt; 3      PHQ     ASV3        Control Control - Treatment     0.036157236</span></span>
<span><span class="co">#&gt; 4      PHQ     ASV4        Control Control - Treatment     0.005179493</span></span>
<span><span class="co">#&gt; 5      PHQ     ASV5        Control Control - Treatment    -0.015848643</span></span>
<span><span class="co">#&gt; 6      PHQ     ASV1      Treatment Control - Treatment     0.002020718</span></span>
<span><span class="co">#&gt; 7      PHQ     ASV2      Treatment Control - Treatment    -0.022797615</span></span>
<span><span class="co">#&gt; 8      PHQ     ASV3      Treatment Control - Treatment     0.036157236</span></span>
<span><span class="co">#&gt; 9      PHQ     ASV4      Treatment Control - Treatment     0.005179493</span></span>
<span><span class="co">#&gt; 10     PHQ     ASV5      Treatment Control - Treatment    -0.015848643</span></span></code></pre>
<p>So far, we’ve done everything using just linear models. We could
actually have computed all these effects just by looking at parameter
estimates. What’s nice is that we can plug in many differnet kinds of
mediation or outcome models. The package already includes interfaces to
the logistic-normal multinomial, sparse regression with glmnet, random
forests with ranger, and bayesian models with brms. It’s also not too
difficult to extend to new model types (we should add a vignette).
Here’s an example of everything we did above but for glmnet. The fact
that all the estimates are 0 is a good thing – there are no real effects
in the simulated data.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multimedia.html">multimedia</a></span><span class="op">(</span><span class="va">exper</span>, <span class="fu"><a href="../reference/glmnet_model.html">glmnet_model</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/estimate.html">estimate</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/direct_effect.html">direct_effect</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt;   outcome indirect_setting            contrast direct_effect</span></span>
<span><span class="co">#&gt; 1     PHQ          Control Control - Treatment   -0.05366268</span></span>
<span><span class="co">#&gt; 2     PHQ        Treatment Control - Treatment   -0.05366268</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/indirect_overall.html">indirect_overall</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt;   outcome direct_setting            contrast indirect_effect</span></span>
<span><span class="co">#&gt; 1     PHQ        Control Control - Treatment      0.01384187</span></span>
<span><span class="co">#&gt; 2     PHQ      Treatment Control - Treatment      0.01384187</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/indirect_pathwise.html">indirect_pathwise</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt;    outcome mediator direct_setting            contrast indirect_effect</span></span>
<span><span class="co">#&gt; 1      PHQ     ASV1        Control Control - Treatment     0.000000000</span></span>
<span><span class="co">#&gt; 2      PHQ     ASV2        Control Control - Treatment     0.000000000</span></span>
<span><span class="co">#&gt; 3      PHQ     ASV3        Control Control - Treatment     0.022930790</span></span>
<span><span class="co">#&gt; 4      PHQ     ASV4        Control Control - Treatment     0.000000000</span></span>
<span><span class="co">#&gt; 5      PHQ     ASV5        Control Control - Treatment    -0.009088919</span></span>
<span><span class="co">#&gt; 6      PHQ     ASV1      Treatment Control - Treatment     0.000000000</span></span>
<span><span class="co">#&gt; 7      PHQ     ASV2      Treatment Control - Treatment     0.000000000</span></span>
<span><span class="co">#&gt; 8      PHQ     ASV3      Treatment Control - Treatment     0.022930790</span></span>
<span><span class="co">#&gt; 9      PHQ     ASV4      Treatment Control - Treatment     0.000000000</span></span>
<span><span class="co">#&gt; 10     PHQ     ASV5      Treatment Control - Treatment    -0.009088919</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="inference">Inference<a class="anchor" aria-label="anchor" href="#inference"></a>
</h2>
<p>Effect estimates are rarely enough on their own. We need some
uncertainty assessments to set appropriate expectations. The most
straightforward approach is to use the bootstrap. Each function in the
third argument, <code>fs</code>, will get its own data.frame with the
bootstrap distribution for that estimator.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bootstrap.html">bootstrap</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>direct_effect <span class="op">=</span> <span class="va">direct_effect</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">direct_effect</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt;    bootstrap outcome indirect_setting            contrast direct_effect</span></span>
<span><span class="co">#&gt; 1          1     PHQ          Control Control - Treatment   -0.07762666</span></span>
<span><span class="co">#&gt; 2          1     PHQ        Treatment Control - Treatment   -0.07762666</span></span>
<span><span class="co">#&gt; 3          2     PHQ          Control Control - Treatment   -0.13247632</span></span>
<span><span class="co">#&gt; 4          2     PHQ        Treatment Control - Treatment   -0.13247632</span></span>
<span><span class="co">#&gt; 5          3     PHQ          Control Control - Treatment   -0.08455178</span></span>
<span><span class="co">#&gt; 6          3     PHQ        Treatment Control - Treatment   -0.08455178</span></span>
<span><span class="co">#&gt; 7          4     PHQ          Control Control - Treatment   -0.10422923</span></span>
<span><span class="co">#&gt; 8          4     PHQ        Treatment Control - Treatment   -0.10422923</span></span>
<span><span class="co">#&gt; 9          5     PHQ          Control Control - Treatment   -0.15210409</span></span>
<span><span class="co">#&gt; 10         5     PHQ        Treatment Control - Treatment   -0.15210409</span></span></code></pre>
<p>We can also generate synthetic nulls to calibrate selection sets. The
third argument says which set of edges we want to remove under the null.
In this case we will generate synthetic null data where there is known
to be no relationship between the mediators and outcome. The fourth
argument says which effect estimates we should evaluate. We then fit the
full model on both the original and the synthetic null data. We can
define false discovery rate thresholds by ranking estimates across the
two data sets. If we see many null effects mixed in among the strong
effects in real data, we know to trust only the very strongest real
effects (if any).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contrast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/null_contrast.html">null_contrast</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span>, <span class="st">"M-&gt;Y"</span>, <span class="va">indirect_pathwise</span><span class="op">)</span></span>
<span><span class="va">fdr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdr_summary.html">fdr_summary</a></span><span class="op">(</span><span class="va">contrast</span>, <span class="st">"indirect_pathwise"</span>, <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">fdr</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; # A tibble: 10 × 8</span></span>
<span><span class="co">#&gt;    source    outcome mediator indirect_effect .group     rank fdr_hat keep </span></span>
<span><span class="co">#&gt;                                    </span></span>
<span><span class="co">#&gt;  1 real      PHQ     ASV3             0.0229  drop_last     1   0     FALSE</span></span>
<span><span class="co">#&gt;  2 synthetic PHQ     ASV4             0.0226  drop_last     2   0.5   FALSE</span></span>
<span><span class="co">#&gt;  3 synthetic PHQ     ASV3             0.0128  drop_last     3   0.667 FALSE</span></span>
<span><span class="co">#&gt;  4 real      PHQ     ASV5            -0.00909 drop_last     4   0.5   FALSE</span></span>
<span><span class="co">#&gt;  5 real      PHQ     ASV1             0       drop_last     5   0.4   FALSE</span></span>
<span><span class="co">#&gt;  6 real      PHQ     ASV2             0       drop_last     6   0.333 FALSE</span></span>
<span><span class="co">#&gt;  7 real      PHQ     ASV4             0       drop_last     7   0.286 FALSE</span></span>
<span><span class="co">#&gt;  8 synthetic PHQ     ASV1             0       drop_last     8   0.375 FALSE</span></span>
<span><span class="co">#&gt;  9 synthetic PHQ     ASV2             0       drop_last     9   0.444 FALSE</span></span>
<span><span class="co">#&gt; 10 synthetic PHQ     ASV5             0       drop_last    10   0.5   FALSE</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; R version 4.4.1 (2024-06-14)</span></span>
<span><span class="co">#&gt; Platform: aarch64-apple-darwin20</span></span>
<span><span class="co">#&gt; Running under: macOS Sonoma 14.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib </span></span>
<span><span class="co">#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt; [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: America/Chicago</span></span>
<span><span class="co">#&gt; tzcode source: internal</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">#&gt; [8] base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt;  [1] ggraph_2.2.1                multimedia_0.1.0           </span></span>
<span><span class="co">#&gt;  [3] tidyselect_1.2.1            SummarizedExperiment_1.35.1</span></span>
<span><span class="co">#&gt;  [5] Biobase_2.65.0              GenomicRanges_1.57.1       </span></span>
<span><span class="co">#&gt;  [7] GenomeInfoDb_1.41.1         IRanges_2.39.2             </span></span>
<span><span class="co">#&gt;  [9] S4Vectors_0.43.2            BiocGenerics_0.51.0        </span></span>
<span><span class="co">#&gt; [11] MatrixGenerics_1.17.0       matrixStats_1.3.0          </span></span>
<span><span class="co">#&gt; [13] ggplot2_3.5.1               BiocStyle_2.33.1           </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;   [1] gridExtra_2.3           permute_0.9-7           rlang_1.1.4            </span></span>
<span><span class="co">#&gt;   [4] magrittr_2.0.3          ade4_1.7-22             compiler_4.4.1         </span></span>
<span><span class="co">#&gt;   [7] mgcv_1.9-1              systemfonts_1.1.0       vctrs_0.6.5            </span></span>
<span><span class="co">#&gt;  [10] reshape2_1.4.4          stringr_1.5.1           shape_1.4.6.1          </span></span>
<span><span class="co">#&gt;  [13] pkgconfig_2.0.3         crayon_1.5.3            fastmap_1.2.0          </span></span>
<span><span class="co">#&gt;  [16] XVector_0.45.0          labeling_0.4.3          utf8_1.2.4             </span></span>
<span><span class="co">#&gt;  [19] rmarkdown_2.28          UCSC.utils_1.1.0        glmnetUtils_1.1.9      </span></span>
<span><span class="co">#&gt;  [22] ragg_1.3.2              purrr_1.0.2             glmnet_4.1-8           </span></span>
<span><span class="co">#&gt;  [25] xfun_0.47               zlibbioc_1.51.1         cachem_1.1.0           </span></span>
<span><span class="co">#&gt;  [28] jsonlite_1.8.8          biomformat_1.33.0       progress_1.2.3         </span></span>
<span><span class="co">#&gt;  [31] highr_0.11              rhdf5filters_1.17.0     DelayedArray_0.31.11   </span></span>
<span><span class="co">#&gt;  [34] tweenr_2.0.3            Rhdf5lib_1.27.0         parallel_4.4.1         </span></span>
<span><span class="co">#&gt;  [37] prettyunits_1.2.0       cluster_2.1.6           R6_2.5.1               </span></span>
<span><span class="co">#&gt;  [40] bslib_0.8.0             stringi_1.8.4           jquerylib_0.1.4        </span></span>
<span><span class="co">#&gt;  [43] Rcpp_1.0.13             bookdown_0.40           iterators_1.0.14       </span></span>
<span><span class="co">#&gt;  [46] knitr_1.48              Matrix_1.7-0            splines_4.4.1          </span></span>
<span><span class="co">#&gt;  [49] igraph_2.0.3            viridis_0.6.5           abind_1.4-5            </span></span>
<span><span class="co">#&gt;  [52] yaml_2.3.10             vegan_2.6-8             codetools_0.2-20       </span></span>
<span><span class="co">#&gt;  [55] lattice_0.22-6          tibble_3.2.1            plyr_1.8.9             </span></span>
<span><span class="co">#&gt;  [58] withr_3.0.1             evaluate_0.24.0         desc_1.4.3             </span></span>
<span><span class="co">#&gt;  [61] survival_3.7-0          polyclip_1.10-7         Biostrings_2.73.1      </span></span>
<span><span class="co">#&gt;  [64] pillar_1.9.0            BiocManager_1.30.24     phyloseq_1.49.0        </span></span>
<span><span class="co">#&gt;  [67] foreach_1.5.2           insight_0.20.3          generics_0.1.3         </span></span>
<span><span class="co">#&gt;  [70] hms_1.1.3               munsell_0.5.1           scales_1.3.0           </span></span>
<span><span class="co">#&gt;  [73] glue_1.7.0              tools_4.4.1             data.table_1.16.0      </span></span>
<span><span class="co">#&gt;  [76] graphlayouts_1.1.1      fs_1.6.4                tidygraph_1.3.1        </span></span>
<span><span class="co">#&gt;  [79] rhdf5_2.49.0            grid_4.4.1              tidyr_1.3.1            </span></span>
<span><span class="co">#&gt;  [82] ape_5.8                 colorspace_2.1-1        nlme_3.1-166           </span></span>
<span><span class="co">#&gt;  [85] formula.tools_1.7.1     GenomeInfoDbData_1.2.12 ggforce_0.4.2          </span></span>
<span><span class="co">#&gt;  [88] cli_3.6.3               textshaping_0.4.0       fansi_1.0.6            </span></span>
<span><span class="co">#&gt;  [91] viridisLite_0.4.2       S4Arrays_1.5.7          dplyr_1.1.4            </span></span>
<span><span class="co">#&gt;  [94] gtable_0.3.5            sass_0.4.9              digest_0.6.37          </span></span>
<span><span class="co">#&gt;  [97] operator.tools_1.6.3    ggrepel_0.9.5           SparseArray_1.5.31     </span></span>
<span><span class="co">#&gt; [100] farver_2.1.2            htmlwidgets_1.6.4       memoise_2.0.1          </span></span>
<span><span class="co">#&gt; [103] htmltools_0.5.8.1       pkgdown_2.1.0           multtest_2.61.0        </span></span>
<span><span class="co">#&gt; [106] lifecycle_1.0.4         httr_1.4.7              MASS_7.3-61</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Kris Sankaran, Hanying Jiang.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
