<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quick Start with Random Data • multimedia</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Quick Start with Random Data">
<meta property="og:description" content="multimedia">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">multimedia</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/IBD.html">Microbiome - Metabolome Mediation Analysis</a>
    </li>
    <li>
      <a href="../articles/illustration.html">Illustration with Nonlinear Effects</a>
    </li>
    <li>
      <a href="../articles/mindfulness.html">The Mindfulness Study</a>
    </li>
    <li>
      <a href="../articles/random.html">Quick Start with Random Data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Quick Start with Random Data</h1>
            
      
      
      <div class="hidden name"><code>random.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">multimedia</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggraph.data-imaginist.com" class="external-link">ggraph</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette gives a brief introduction using simulated that
resemble a mediation analysis of the gut-brain axis. The basic question
is – we know that meditation can reduce depression and anxiety symptoms,
so is it possible that microbiome shifts might play a role? In the
language of mediation analysis, does the microbiome mediate Public
Health Questionnaire-9 (PHQ) score?</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/demo_joy.html">demo_joy</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; class: SummarizedExperiment </span></span>
<span><span class="co">#&gt; dim: 5 100 </span></span>
<span><span class="co">#&gt; metadata(0):</span></span>
<span><span class="co">#&gt; assays(1): counts</span></span>
<span><span class="co">#&gt; rownames(5): ASV1 ASV2 ASV3 ASV4 ASV5</span></span>
<span><span class="co">#&gt; rowData names(0):</span></span>
<span><span class="co">#&gt; colnames: NULL</span></span>
<span><span class="co">#&gt; colData names(2): treatment PHQ</span></span></code></pre>
<p>For mediation analysis, we distinguish between the different variable
types. This data structures defines treatment, mediator, and outcome
group using tidyselect-style notation.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exper</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mediation_data.html">mediation_data</a></span><span class="op">(</span><span class="fu"><a href="../reference/demo_joy.html">demo_joy</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"PHQ"</span>, <span class="st">"treatment"</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"ASV"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">exper</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; [Mediation Data] </span></span>
<span><span class="co">#&gt; 100 samples with measurements for, </span></span>
<span><span class="co">#&gt; 1 treatment: treatment </span></span>
<span><span class="co">#&gt; 5 mediators: ASV1, ASV2, ... </span></span>
<span><span class="co">#&gt; 1 outcome: PHQ</span></span></code></pre>
<p>This is the main estimation function. By default, we fit a separate
linear regression model for each mediation and outcome variable.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multimedia.html">multimedia</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/estimate.html">estimate</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; [Multimedia Analysis] </span></span>
<span><span class="co">#&gt; Treatments: treatment </span></span>
<span><span class="co">#&gt; Outcomes: PHQ </span></span>
<span><span class="co">#&gt; Mediators: ASV1, ASV2, ... </span></span>
<span><span class="co">#&gt;   </span></span>
<span><span class="co">#&gt; [Models] </span></span>
<span><span class="co">#&gt; mediation: A fitted lm_model(). </span></span>
<span><span class="co">#&gt; outcome: A fitted lm_model().</span></span></code></pre>
<p>The <code>edges</code> slot tracks all the variable relationships.
For example, we can visualize the causal graph using the
<code>ggraph</code> code below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">model</span><span class="op">@</span><span class="va">edges</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html" class="external-link">geom_edge_link</a></span><span class="op">(</span>arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_text.html" class="external-link">geom_node_label</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">name</span>, fill <span class="op">=</span> <span class="va">node_type</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="random_files/figure-html/graph-1.png" width="600" style="display: block; margin: auto;"></p>
<p>Now that we’ve coupled the mediation and outcome models, we can
propogate predictions and samples through them. That is, we can define
certain configurations of the treatment (and pretreatments, if we have
them) and then use the fitted models to simulate new mediation and
outcome samples. By default, it will sample at the template data that
was used to fit the model, just like the <code>predict</code> method for
<code>lm</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; [Mediation Data] </span></span>
<span><span class="co">#&gt; 2 samples with measurements for, </span></span>
<span><span class="co">#&gt; 1 treatment: treatment </span></span>
<span><span class="co">#&gt; 5 mediators: ASV1, ASV2, ... </span></span>
<span><span class="co">#&gt; 1 outcome: PHQ</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; $mediators</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 5</span></span>
<span><span class="co">#&gt;     ASV1    ASV2  ASV3   ASV4   ASV5</span></span>
<span><span class="co">#&gt;            </span></span>
<span><span class="co">#&gt; 1 0.0633 -0.0174 0.147 -0.107 0.0852</span></span>
<span><span class="co">#&gt; 2 0.0687  0.169  0.126 -0.125 0.0107</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $outcomes</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 1</span></span>
<span><span class="co">#&gt;       PHQ</span></span>
<span><span class="co">#&gt;     </span></span>
<span><span class="co">#&gt; 1 -0.0927</span></span>
<span><span class="co">#&gt; 2 -0.106</span></span></code></pre>
<p>Things get more interesting when we sample at new treatment and
pretreatment configurations. We need to be careful with our accounting,
because we want the flexibility to provide different combinations of
treatments to different sets of edges. For example, we may want to
imagine that the edge for one particular mediator was set to treatment
while all others were left at control. The example below has one sample
with this kind of configuration and three others that keep all edges at
control.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t_mediator</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">@</span><span class="va">treatments</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">t_outcome</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">@</span><span class="va">treatments</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">profile</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_profile.html">setup_profile</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">t_mediator</span>, <span class="va">t_outcome</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">model</span>, profile <span class="op">=</span> <span class="va">profile</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; [Mediation Data] </span></span>
<span><span class="co">#&gt; 4 samples with measurements for, </span></span>
<span><span class="co">#&gt; 1 treatment: treatment </span></span>
<span><span class="co">#&gt; 5 mediators: ASV1, ASV2, ... </span></span>
<span><span class="co">#&gt; 1 outcome: PHQ</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, profile <span class="op">=</span> <span class="va">profile</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; $mediators</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 5</span></span>
<span><span class="co">#&gt;     ASV1    ASV2  ASV3   ASV4   ASV5</span></span>
<span><span class="co">#&gt;            </span></span>
<span><span class="co">#&gt; 1 0.0687  0.169  0.126 -0.125 0.0107</span></span>
<span><span class="co">#&gt; 2 0.0633 -0.0174 0.147 -0.107 0.0852</span></span>
<span><span class="co">#&gt; 3 0.0633 -0.0174 0.147 -0.107 0.0852</span></span>
<span><span class="co">#&gt; 4 0.0633 -0.0174 0.147 -0.107 0.0852</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $outcomes</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 1</span></span>
<span><span class="co">#&gt;       PHQ</span></span>
<span><span class="co">#&gt;     </span></span>
<span><span class="co">#&gt; 1 -0.0855</span></span>
<span><span class="co">#&gt; 2 -0.0927</span></span>
<span><span class="co">#&gt; 3 -0.0927</span></span>
<span><span class="co">#&gt; 4 -0.0927</span></span></code></pre>
<p>We can also contrast the predictions and samples under different
profiles.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">profile_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_profile.html">setup_profile</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">model</span><span class="op">@</span><span class="va">treatments</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>, <span class="op">]</span>, <span class="va">t_outcome</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/contrast_predictions.html">contrast_predictions</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">profile</span>, <span class="va">profile_control</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; $mediators</span></span>
<span><span class="co">#&gt;          ASV1      ASV2        ASV3        ASV4        ASV5</span></span>
<span><span class="co">#&gt; 1 0.005368941 0.1858563 -0.02092859 -0.01807409 -0.07448229</span></span>
<span><span class="co">#&gt; 2 0.000000000 0.0000000  0.00000000  0.00000000  0.00000000</span></span>
<span><span class="co">#&gt; 3 0.000000000 0.0000000  0.00000000  0.00000000  0.00000000</span></span>
<span><span class="co">#&gt; 4 0.000000000 0.0000000  0.00000000  0.00000000  0.00000000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $outcomes</span></span>
<span><span class="co">#&gt;           PHQ</span></span>
<span><span class="co">#&gt; 1 0.007116197</span></span>
<span><span class="co">#&gt; 2 0.000000000</span></span>
<span><span class="co">#&gt; 3 0.000000000</span></span>
<span><span class="co">#&gt; 4 0.000000000</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/contrast_samples.html">contrast_samples</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">profile</span>, <span class="va">profile_control</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; $mediators</span></span>
<span><span class="co">#&gt;         ASV1        ASV2       ASV3       ASV4       ASV5</span></span>
<span><span class="co">#&gt; 1 -2.7561171  0.04931431 -1.3183499 -0.4387669 -1.9117206</span></span>
<span><span class="co">#&gt; 2  0.4884316 -0.96868217  0.4702442 -2.4740526 -0.5568664</span></span>
<span><span class="co">#&gt; 3 -0.3340056 -1.39298503  0.4320600  1.9022918  1.7160006</span></span>
<span><span class="co">#&gt; 4 -2.3788383 -3.51770139  2.2354191 -1.5366617  0.6446920</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $outcomes</span></span>
<span><span class="co">#&gt;          PHQ</span></span>
<span><span class="co">#&gt; 1 -1.3250145</span></span>
<span><span class="co">#&gt; 2  0.2381951</span></span>
<span><span class="co">#&gt; 3 -1.0210808</span></span>
<span><span class="co">#&gt; 4  0.8207142</span></span></code></pre>
<div class="section level2">
<h2 id="effect-estimates">Effect Estimates<a class="anchor" aria-label="anchor" href="#effect-estimates"></a>
</h2>
<p>It’s a small step from contrasting different configurations to asking
for the direct and indirect treatments effects. The direct effect is
defined as the average of <span class="math inline">\(\hat{Y}\left(\hat{M}\left(t'\right), 1\right)
- \hat{Y}\left(\hat{M}\left(t'\right), 0\right)\)</span> across
mediator treatment effects <span class="math inline">\(t'\)</span>.
The hats mean that we use the predicted values from the mediation and
outcome values. I’ve distinguished between “overall” and “pathwise”
indirect effects because we’re working with high-dimensional mediators.
In the overall effect, we toggle treatment/control status for incoming
edges to all mediators. In pathwise indirect effects, we toggle only the
treatment going into one mediator.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/direct_effect.html">direct_effect</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span><span class="co">#&gt;   outcome indirect_setting contrast            direct_effect</span></span>
<span><span class="co">#&gt;                                        </span></span>
<span><span class="co">#&gt; 1 PHQ     Treatment        Treatment - Control        0.0209</span></span>
<span><span class="co">#&gt; 2 PHQ     Control          Treatment - Control        0.0209</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/indirect_overall.html">indirect_overall</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span><span class="co">#&gt;   outcome direct_setting contrast            indirect_effect</span></span>
<span><span class="co">#&gt;                                        </span></span>
<span><span class="co">#&gt; 1 PHQ     Treatment      Treatment - Control        -0.00712</span></span>
<span><span class="co">#&gt; 2 PHQ     Control        Treatment - Control        -0.00712</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/indirect_pathwise.html">indirect_pathwise</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; # A tibble: 10 × 5</span></span>
<span><span class="co">#&gt;    outcome mediator direct_setting contrast            indirect_effect</span></span>
<span><span class="co">#&gt;                                             </span></span>
<span><span class="co">#&gt;  1 PHQ     ASV1     Treatment      Treatment - Control       -0.000192</span></span>
<span><span class="co">#&gt;  2 PHQ     ASV2     Treatment      Treatment - Control        0.00358 </span></span>
<span><span class="co">#&gt;  3 PHQ     ASV3     Treatment      Treatment - Control       -0.00564 </span></span>
<span><span class="co">#&gt;  4 PHQ     ASV4     Treatment      Treatment - Control        0.000128</span></span>
<span><span class="co">#&gt;  5 PHQ     ASV5     Treatment      Treatment - Control       -0.00499 </span></span>
<span><span class="co">#&gt;  6 PHQ     ASV1     Control        Treatment - Control       -0.000192</span></span>
<span><span class="co">#&gt;  7 PHQ     ASV2     Control        Treatment - Control        0.00358 </span></span>
<span><span class="co">#&gt;  8 PHQ     ASV3     Control        Treatment - Control       -0.00564 </span></span>
<span><span class="co">#&gt;  9 PHQ     ASV4     Control        Treatment - Control        0.000128</span></span>
<span><span class="co">#&gt; 10 PHQ     ASV5     Control        Treatment - Control       -0.00499</span></span></code></pre>
<p>So far, we’ve done everything using just linear models. We could
actually have computed all these effects just by looking at parameter
estimates. What’s nice is that we can plug in many differnet kinds of
mediation or outcome models. The package already includes interfaces to
the logistic-normal multinomial, sparse regression with glmnet, random
forests with ranger, and bayesian models with brms. It’s also not too
difficult to extend to new model types (we should add a vignette).
Here’s an example of everything we did above but for glmnet. The fact
that all the estimates are 0 is a good thing – there are no real effects
in the simulated data.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multimedia.html">multimedia</a></span><span class="op">(</span><span class="va">exper</span>, <span class="fu"><a href="../reference/glmnet_model.html">glmnet_model</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/estimate.html">estimate</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/direct_effect.html">direct_effect</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span><span class="co">#&gt;   outcome indirect_setting contrast            direct_effect</span></span>
<span><span class="co">#&gt;                                        </span></span>
<span><span class="co">#&gt; 1 PHQ     Treatment        Treatment - Control             0</span></span>
<span><span class="co">#&gt; 2 PHQ     Control          Treatment - Control             0</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/indirect_overall.html">indirect_overall</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span><span class="co">#&gt;   outcome direct_setting contrast            indirect_effect</span></span>
<span><span class="co">#&gt;                                        </span></span>
<span><span class="co">#&gt; 1 PHQ     Treatment      Treatment - Control        -0.00393</span></span>
<span><span class="co">#&gt; 2 PHQ     Control        Treatment - Control        -0.00393</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/indirect_pathwise.html">indirect_pathwise</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; # A tibble: 10 × 5</span></span>
<span><span class="co">#&gt;    outcome mediator direct_setting contrast            indirect_effect</span></span>
<span><span class="co">#&gt;                                             </span></span>
<span><span class="co">#&gt;  1 PHQ     ASV1     Treatment      Treatment - Control         0      </span></span>
<span><span class="co">#&gt;  2 PHQ     ASV2     Treatment      Treatment - Control         0      </span></span>
<span><span class="co">#&gt;  3 PHQ     ASV3     Treatment      Treatment - Control        -0.00393</span></span>
<span><span class="co">#&gt;  4 PHQ     ASV4     Treatment      Treatment - Control         0      </span></span>
<span><span class="co">#&gt;  5 PHQ     ASV5     Treatment      Treatment - Control         0      </span></span>
<span><span class="co">#&gt;  6 PHQ     ASV1     Control        Treatment - Control         0      </span></span>
<span><span class="co">#&gt;  7 PHQ     ASV2     Control        Treatment - Control         0      </span></span>
<span><span class="co">#&gt;  8 PHQ     ASV3     Control        Treatment - Control        -0.00393</span></span>
<span><span class="co">#&gt;  9 PHQ     ASV4     Control        Treatment - Control         0      </span></span>
<span><span class="co">#&gt; 10 PHQ     ASV5     Control        Treatment - Control         0</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="inference">Inference<a class="anchor" aria-label="anchor" href="#inference"></a>
</h2>
<p>Effect estimates are rarely enough on their own. We need some
uncertainty assessments to set appropriate expectations. The most
straightforward approach is to use the bootstrap. Each element in
<code>funs</code> will get its own data.frame with the bootstrap
distribution for that estimator.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">funs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>direct_effect <span class="op">=</span> <span class="va">direct_effect</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/bootstrap.html">bootstrap</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span>, <span class="va">funs</span>, B <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; $direct_effect</span></span>
<span><span class="co">#&gt; # A tibble: 200 × 5</span></span>
<span><span class="co">#&gt;    bootstrap outcome indirect_setting contrast            direct_effect</span></span>
<span><span class="co">#&gt;                                              </span></span>
<span><span class="co">#&gt;  1 1         PHQ     Control          Control - Treatment      -0.0796 </span></span>
<span><span class="co">#&gt;  2 1         PHQ     Treatment        Control - Treatment      -0.0796 </span></span>
<span><span class="co">#&gt;  3 2         PHQ     Control          Control - Treatment      -0.00809</span></span>
<span><span class="co">#&gt;  4 2         PHQ     Treatment        Control - Treatment      -0.00809</span></span>
<span><span class="co">#&gt;  5 3         PHQ     Control          Control - Treatment       0      </span></span>
<span><span class="co">#&gt;  6 3         PHQ     Treatment        Control - Treatment       0      </span></span>
<span><span class="co">#&gt;  7 4         PHQ     Control          Control - Treatment       0.00630</span></span>
<span><span class="co">#&gt;  8 4         PHQ     Treatment        Control - Treatment       0.00630</span></span>
<span><span class="co">#&gt;  9 5         PHQ     Control          Control - Treatment       0      </span></span>
<span><span class="co">#&gt; 10 5         PHQ     Treatment        Control - Treatment       0      </span></span>
<span><span class="co">#&gt; # ℹ 190 more rows</span></span></code></pre>
<p>We can also generate synthetic nulls to calibrate selection sets. The
third argument says which set of edges we want to remove under the null.
In this case we will generate synthetic null data where there is known
to be no relationship between the mediators and outcome. The fourth
argument says which effect estimates we should evaluate. We then fit the
full model on both the original and the synthetic null data. We can
define false discovery rate thresholds by ranking estimates across the
two data sets. If we see many null effects mixed in among the strong
effects in real data, we know to trust only the very strongest real
effects (if any).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contrast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/null_contrast.html">null_contrast</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span>, <span class="st">"M-&gt;Y"</span>, <span class="va">indirect_pathwise</span><span class="op">)</span></span>
<span><span class="va">fdr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdr_summary.html">fdr_summary</a></span><span class="op">(</span><span class="va">contrast</span>, <span class="st">"indirect_pathwise"</span>, <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">fdr</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; # A tibble: 10 × 8</span></span>
<span><span class="co">#&gt;    source    outcome mediator indirect_effect .group     rank fdr_hat keep </span></span>
<span><span class="co">#&gt;                                    </span></span>
<span><span class="co">#&gt;  1 synthetic PHQ     ASV2            -0.0298  drop_last     1   1     FALSE</span></span>
<span><span class="co">#&gt;  2 real      PHQ     ASV3            -0.00393 drop_last     2   0.5   FALSE</span></span>
<span><span class="co">#&gt;  3 real      PHQ     ASV1             0       drop_last     3   0.333 FALSE</span></span>
<span><span class="co">#&gt;  4 real      PHQ     ASV2             0       drop_last     4   0.25  FALSE</span></span>
<span><span class="co">#&gt;  5 real      PHQ     ASV4             0       drop_last     5   0.2   FALSE</span></span>
<span><span class="co">#&gt;  6 real      PHQ     ASV5             0       drop_last     6   0.167 FALSE</span></span>
<span><span class="co">#&gt;  7 synthetic PHQ     ASV1             0       drop_last     7   0.286 FALSE</span></span>
<span><span class="co">#&gt;  8 synthetic PHQ     ASV3             0       drop_last     8   0.375 FALSE</span></span>
<span><span class="co">#&gt;  9 synthetic PHQ     ASV4             0       drop_last     9   0.444 FALSE</span></span>
<span><span class="co">#&gt; 10 synthetic PHQ     ASV5             0       drop_last    10   0.5   FALSE</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Kris Sankaran.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
