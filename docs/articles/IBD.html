<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Microbiome - Metabolome Mediation Analysis • multimedia</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Microbiome - Metabolome Mediation Analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">multimedia</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/IBD.html">Microbiome - Metabolome Mediation Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/illustration.html">Illustration with Nonlinear Effects</a></li>
    <li><a class="dropdown-item" href="../articles/mindfulness.html">The Mindfulness Study</a></li>
    <li><a class="dropdown-item" href="../articles/random.html">Quick Start with Random Data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/krisrs1128/multimedia/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Microbiome - Metabolome Mediation Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/krisrs1128/multimedia/blob/HEAD/vignettes/IBD.Rmd" class="external-link"><code>vignettes/IBD.Rmd</code></a></small>
      <div class="d-none name"><code>IBD.Rmd</code></div>
    </div>

    
    
<p>Joint microbiome-metabolome experiments can give a view into how
microbes shape their environments. <code>multimedia</code> lets us
analyze high-dimensional outcome and mediation variables simultaneously.
This allows us to analyze treatment
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>→</mo><annotation encoding="application/x-tex">\to</annotation></semantics></math>
microbiome
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>→</mo><annotation encoding="application/x-tex">\to</annotation></semantics></math>
metabolome and treatment
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>→</mo><annotation encoding="application/x-tex">\to</annotation></semantics></math>
metabolome
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>→</mo><annotation encoding="application/x-tex">\to</annotation></semantics></math>
microbiome paths. The methodology only allows us to analyze one kind of
path at a time; in any case, it’s impossible to completely disambiguate
the directionality of the association from a single timepoint without
prior knowledge. That said, the relationships that are uncovered from
either of these directions can already suggest novel microbe-metabolite
relationships.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stat.boogaart.de/compositions/" class="external-link">compositions</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/ggdist/" class="external-link">ggdist</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glue.tidyverse.org/" class="external-link">glue</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vroom.r-lib.org" class="external-link">vroom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://krisrs1128.github.io/multimedia/">multimedia</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">20231222</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="data-processing">Data Processing<a class="anchor" aria-label="anchor" href="#data-processing"></a>
</h2>
<p>We’ll load data from the Borenstein Lab’s <a href="https://go.wisc.edu/582dhj" class="external-link">microbiome-metabolome curated data</a>
repository. This is a great resource that consistently documents each
study and ensures uniform data processing. Our data is from <a href="https://go.wisc.edu/14b4a2" class="external-link">Franzosa et al.’s</a> study of
intestinal bowel disease. We’ll treat disease status as the treatment,
the microbiome as mediators, and metabolites as the outcome, in the
spirit of that study’s discussion:</p>
<blockquote>
<p>Together, these findings suggest that yet-to-be characterized
molecules in the gut metabolome, linked to inflammation and ultimately
IBD, may be largely microbially derived or modified.</p>
</blockquote>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span><span class="st">"VROOM_CONNECTION_SIZE"</span> <span class="op">=</span> <span class="fl">5e6</span><span class="op">)</span></span>
<span><span class="va">taxa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_tsv</a></span><span class="op">(</span><span class="st">"https://go.wisc.edu/l015v0"</span><span class="op">)</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">metabolites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_tsv</a></span><span class="op">(</span><span class="st">"https://go.wisc.edu/0t3gs3"</span><span class="op">)</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_tsv</a></span><span class="op">(</span><span class="st">"https://go.wisc.edu/9z36wr"</span><span class="op">)</span></span></code></pre></div>
<p>We’ll filter quite aggressively so that the examples in this vignette
run quickly. We then compile everything into a
<code>mediation_data</code> object that organizes the treatment,
mediators, and outcomes. We apply a centered log transform to the
microbiome relative abundance and a log transform to the metabolite
expression levels. Note that I’ve hidden some of the preprocessing
functions (e.g., <code>simplify_tax_names</code>); these do what you
expect, and you can read them in the <code>.Rmd</code> source.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">taxa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/compositions/man/clr.html" class="external-link">clr</a></span><span class="op">(</span><span class="va">taxa</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">filter_mean</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">simplify_tax_names</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">metabolites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">metabolites</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">filter_mean</span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="fu">annotated_metabolites</span><span class="op">(</span><span class="va">metabolites</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">simplify_metab_names</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">combined</span> <span class="op">&lt;-</span> <span class="va">metabolites</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">taxa</span>, <span class="va">metadata</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">exper</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mediation_data.html">mediation_data</a></span><span class="op">(</span></span>
<span>    <span class="va">combined</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">metabolites</span><span class="op">)</span>,</span>
<span>    <span class="st">"Study.Group"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">taxa</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">exper</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; [Mediation Data] </span></span>
<span><span class="co">#&gt; 220 samples with measurements for, </span></span>
<span><span class="co">#&gt; 1 treatment: Study.Group </span></span>
<span><span class="co">#&gt; 173 mediators: gSutterella, gMarvinbryantia, ... </span></span>
<span><span class="co">#&gt; 155 outcomes: m0031_phenyllactate, m0045_azelate, ...</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="lasso-approach">Lasso Approach<a class="anchor" aria-label="anchor" href="#lasso-approach"></a>
</h2>
<p>We will fit sparse regression models for each outcome so that, for
any metabolite, only a subset of microbes is expected to influence its
abundance.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multimedia.html">multimedia</a></span><span class="op">(</span><span class="va">exper</span>, <span class="fu"><a href="../reference/glmnet_model.html">glmnet_model</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/estimate.html">estimate</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span></span></code></pre></div>
<p>We can have different direct effects depending on the treatment
assignments of the mediators. Here we’ll average over all mediator
settings and plot the features with the largest direct effects. Note
that the boxplots can reflect indirect effects as well, and this is why
the ordering below (based on direct effect estimate) doesn’t exactly
correspond to the distance between the boxplots.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">direct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    CD <span class="op">=</span> <span class="fu"><a href="../reference/direct_effect.html">direct_effect</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span><span class="op">)</span>,</span>
<span>    UC <span class="op">=</span> <span class="fu"><a href="../reference/direct_effect.html">direct_effect</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr</a></span><span class="op">(</span><span class="va">effect_summary</span>, .id <span class="op">=</span> <span class="st">"treatment"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vis_direct</span> <span class="op">&lt;-</span> <span class="va">direct</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">direct_effect</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span></span>
<span></span>
<span><span class="va">combined</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="va">vis_direct</span><span class="op">)</span>, <span class="va">Study.Group</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">Study.Group</span>, names_to <span class="op">=</span> <span class="st">"feature"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">value</span>, <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">feature</span>, <span class="va">value</span>, <span class="va">median</span><span class="op">)</span>,</span>
<span>            fill <span class="op">=</span> <span class="va">Study.Group</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="st">"log(1 + intensity)"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Metabolite"</span>,</span>
<span>        fill <span class="op">=</span> <span class="st">"Group"</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p><img src="IBD_files/figure-html/lasso_direct-1.png" width="600" style="display: block; margin: auto;"></p>
<p>The block below calculates the analogous overall indirect effects.
We’re particularly interested in the difference between metabolites that
have strong indirect vs. direct effects, because these are expected to
have different relationships with the microbiome. To simplify this
comparison, we combine the top direct and indirect effects in the object
<code>top_effects</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">indirect_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    CD <span class="op">=</span> <span class="fu"><a href="../reference/indirect_overall.html">indirect_overall</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span><span class="op">)</span>,</span>
<span>    UC <span class="op">=</span> <span class="fu"><a href="../reference/indirect_overall.html">indirect_overall</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">exper</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">top_direct</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="va">direct</span>, effect <span class="op">=</span> <span class="va">direct_effect</span><span class="op">)</span></span>
<span><span class="va">top_indirect</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">indirect_effect</span><span class="op">)</span>,</span>
<span>    effect <span class="op">=</span> <span class="va">indirect_effect</span></span>
<span><span class="op">)</span></span>
<span><span class="va">top_effects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>direct <span class="op">=</span> <span class="va">top_direct</span>, indirect <span class="op">=</span> <span class="va">top_indirect</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"type"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vis_outcomes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"m0181_hydrocinnamic_acid"</span>, <span class="st">"m1303_lithocholate"</span>,</span>
<span>    <span class="st">"m0036_creatinine"</span>, <span class="st">"m0253_sphingosine"</span>, <span class="st">"m1478_C182_CE"</span>,</span>
<span>    <span class="st">"m0295_arginine"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">top_effects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">top_effects</span>, <span class="va">outcome</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">vis_outcomes</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="va">type</span> <span class="op">==</span> <span class="st">"indirect"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">top_effects</span>, <span class="va">outcome</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">vis_outcomes</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, <span class="va">type</span> <span class="op">==</span> <span class="st">"direct"</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
<p>The plot below is an MDS of microbiome compositions where point sizes
represent metabolite abundances. Notice that the for indirect effects,
there is a clear relationship between metabolites and microbiome
composition. This is consistent with what we expect from a mediation
analysis: Indirect effects have to travel through the mediators, which
in this case are microbiome compositions.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eig</span> <span class="op">&lt;-</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">k</span><span class="op">)</span> <span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">k</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cmdscale.html" class="external-link">cmdscale</a></span><span class="op">(</span><span class="fu">dist</span><span class="op">(</span><span class="fu"><a href="../reference/mediators.html">mediators</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span><span class="op">)</span>, eig <span class="op">=</span> <span class="cn">TRUE</span>, k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">mds</span><span class="op">$</span><span class="va">points</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="fu"><a href="../reference/treatments.html">treatments</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="fu"><a href="../reference/outcomes.html">outcomes</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span><span class="op">[</span>, <span class="va">vis_outcomes</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">top_effects</span><span class="op">$</span><span class="va">outcome</span>,</span>
<span>        names_to <span class="op">=</span> <span class="st">"outcome"</span>,</span>
<span>        values_to <span class="op">=</span> <span class="st">"abundance"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">top_effects</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>abundance_quantile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">abundance</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">X1</span>, <span class="va">X2</span>, col <span class="op">=</span> <span class="va">Study.Group</span>, size <span class="op">=</span> <span class="va">abundance_quantile</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_area</a></span><span class="op">(</span>max_size <span class="op">=</span> <span class="fl">1.5</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"MDS1 [{eig(mds$eig, 1)}%]"</span><span class="op">)</span>,</span>
<span>        y <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"MDS2 [{eig(mds$eig, 2)}%]"</span><span class="op">)</span>,</span>
<span>        size <span class="op">=</span> <span class="st">"Metabolite Abundance Quantile"</span>,</span>
<span>        col <span class="op">=</span> <span class="st">"Group"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">type</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="op">-</span><span class="va">abundance</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="IBD_files/figure-html/unnamed-chunk-3-1.png" width="600" style="display: block; margin: auto;"></p>
<p>Mediation analysis hinges on the assumption that mediators and
outcomes don’t share any unobserved confounding. This assumption can’t
be directly tested with data, but it is possible to see how sensitive
conclusions are to violations of this assumption. Specifically, in
sensitivity analysis, we deliberately imagine that model assumptions are
violated, and examine the extent to which indirect effect estimates
change. <code>multimedia</code> implements several types of experimental
sensitivity analyses (functions starting <code>sensitivity_*</code>).
However, here, we’ll use a more standard approach that correlates the
errors between subsets of mediators and outcomes, implemented in the
<code><a href="../reference/sensitivity.html">sensitivity()</a></code> function. Specifically, we’ll correlate the
mediator model error for <code>gEnterocloster</code> and the outcomes
visualized above (<code>m0181_hydrocinnamic_acid</code>,
<code>m1303_lithocholate</code>, etc.) to see whether our estimated
overall indirect effects are sensitivity to violations in assumptions
for this selection of mediators and outcomes.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">confound_ix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    outcome <span class="op">=</span> <span class="va">vis_outcomes</span>,</span>
<span>    mediator <span class="op">=</span> <span class="st">"gEnterocloster"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">rho_seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># sensitivity_overall &lt;- sensitivity(</span></span>
<span><span class="co">#     model, exper, confound_ix, n_boot = 100, rho_seq = rho_seq, t1 = 1, t2 = 2</span></span>
<span><span class="co"># )</span></span>
<span><span class="va">sensitivity_overall</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"https://go.wisc.edu/aj4vg9"</span><span class="op">)</span></span></code></pre></div>
<p>We visualize the results below. Across correlations strengths from
-0.5 to 0.5, none of the overall indirect effects seem sensitive: Though
magnitudes of the estimated effects may change slightly, the sign of the
estimates remain unchanged for all the mediator-outcome pairs that we
tested. Only the association between <code>gEnterocloster</code> and
<code>m0295_arginine</code> seems at risk of switching, and this mainly
seems to be related to the large variance in its estimate.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sensitivity_overall</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">vis_outcomes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">rho</span>, <span class="va">indirect_effect</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>            ymin <span class="op">=</span> <span class="va">indirect_effect</span> <span class="op">-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">indirect_effect_standard_error</span>, </span>
<span>            ymax <span class="op">=</span> <span class="va">indirect_effect</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">indirect_effect_standard_error</span></span>
<span>        <span class="op">)</span>,</span>
<span>        alpha <span class="op">=</span> <span class="fl">0.2</span>, linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="va">indirect_effect</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="fl">3</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Confounder Correlation Strength"</span> <span class="op">~</span> <span class="va">rho</span><span class="op">)</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Estimated Overall Indirect Effect"</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p><img src="IBD_files/figure-html/visualize_sensitivity_overall-1.png" width="600" style="display: block; margin: auto;"></p>
<p>Pathwise indirect effects are those that appear when modifying the
treatment status for a single mediator. Unlike overall indirect effects,
they give us effects for individual mediator-outcome pairs. Now, instead
of averaging over mediator treatment assignments, we average over direct
edge treatment assignments. The block below is time-consuming, so if you
are following along, you can just read in the pre-computed result in the
next block.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># indirect_sorted &lt;- list(</span></span>
<span><span class="co">#     CD = indirect_pathwise(model, exper),</span></span>
<span><span class="co">#     UC = indirect_pathwise(model, exper, 3, 2)</span></span>
<span><span class="co"># ) |&gt;</span></span>
<span><span class="co">#     map_dfr(effect_summary, .id = "treatment")</span></span>
<span><span class="va">indirect_sorted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"https://go.wisc.edu/0c6qkt"</span><span class="op">)</span></span></code></pre></div>
<p>We can look at the effects which have the strongest indirect effects.
These make sense. For example, genus Biophila seems to have a negative
relationship with Taurine. Maybe that metabolite is produced by a
competitor? Or maybe the microbe eats the metabolite. In any case, IBD
seems to decrease the abundance of Biophila, which consequently
increases the abundance of the metabolite.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">indirect_sorted</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">treatment</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">-</span><span class="va">indirect_effect</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="../reference/plot_mediators.html">plot_mediators</a></span><span class="op">(</span><span class="va">exper</span>, treatment <span class="op">=</span> <span class="st">"Study.Group"</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span><span class="op">[[</span><span class="st">"CD"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="IBD_files/figure-html/lasso_mediators_plot-1.png" width="600" style="display: block; margin: auto;"></p>
<p>We can create models where the effects have been deliberately
removed, which can be used for synthetic null testing. Here are
simulated samples from a “nullified” model without direct effects, a
full model with direct effects, and the original samples. To the extent
that the altered and fitted models differ, the direct treatment edge is
needed to improve model fit.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">altered</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/nullify.html">nullify</a></span><span class="op">(</span><span class="st">"T-&gt;Y"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/estimate.html">estimate</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># sample at original treatment assignments</span></span>
<span><span class="va">profile</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_profile.html">setup_profile</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu"><a href="../reference/treatments.html">treatments</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span>, <span class="fu"><a href="../reference/treatments.html">treatments</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    real <span class="op">=</span> <span class="fu"><a href="../reference/outcomes.html">outcomes</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span>,</span>
<span>    fitted <span class="op">=</span> <span class="fu"><a href="../reference/outcomes.html">outcomes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">model</span>, profile <span class="op">=</span> <span class="va">profile</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    altered <span class="op">=</span> <span class="fu"><a href="../reference/outcomes.html">outcomes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">altered</span>, profile <span class="op">=</span> <span class="va">profile</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"source"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="../reference/treatments.html">treatments</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span><span class="op">$</span><span class="va">Study.Group</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">direct</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">name</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">direct</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># visualize</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">samples</span>, <span class="va">samples</span><span class="op">$</span><span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">samples</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">value</span>, <span class="va">name</span>, fill <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">source</span><span class="op">)</span></span></code></pre></div>
<p><img src="IBD_files/figure-html/lasso_synthetic-1.png" width="600" style="display: block; margin: auto;"></p>
<p>How can we understand the uncertainty of the estimated models? One
approach is to form the bootstrap distribution of the effects that we
care about. It’s a little problematic to form bootstrap confidence
intervals for sparse regression. We can still interpret the full
bootstrap distributions, though. Effects that have large nonzero
components have more evidence of being real. This block is again slow,
so you can skip ahead and load a pre-computed version.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>direct <span class="op">=</span> <span class="va">direct_effect</span>, indirect <span class="op">=</span> <span class="va">indirect_overall</span><span class="op">)</span></span>
<span><span class="co"># inference &lt;- bootstrap(model, exper, fs, B = 1000)</span></span>
<span><span class="va">inference</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">url</a></span><span class="op">(</span><span class="st">"https://go.wisc.edu/08o4l0"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filter_outcomes</span> <span class="op">&lt;-</span> <span class="va">inference</span><span class="op">$</span><span class="va">indirect</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/effect_summary.html">effect_summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>indirect_effect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">indirect_effect</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">indirect_effect</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">inference</span><span class="op">$</span><span class="va">indirect</span>, <span class="va">outcome</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">filter_outcomes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_slabinterval.html" class="external-link">stat_slabinterval</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">indirect_effect</span>, <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="va">indirect_effect</span>, <span class="va">median</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        .width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.66</span>, <span class="fl">.95</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Indirect Effect"</span>, y <span class="op">=</span> <span class="st">"Metabolite"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">filter_outcomes</span> <span class="op">&lt;-</span> <span class="va">inference</span><span class="op">$</span><span class="va">direct</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>direct_effect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">direct_effect</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">direct_effect</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">inference</span><span class="op">$</span><span class="va">direct</span>, <span class="va">outcome</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">filter_outcomes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_slabinterval.html" class="external-link">stat_slabinterval</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">direct_effect</span>, <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="va">direct_effect</span>, <span class="va">median</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        .width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.66</span>, <span class="fl">.95</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Direct Effect"</span>, y <span class="op">=</span> <span class="st">"Metabolite"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">|</span> <span class="va">p2</span></span></code></pre></div>
<p><img src="IBD_files/figure-html/lasso_bootstrap_vis-1.png" width="600" style="display: block; margin: auto;"></p>
<p>Finally, let’s revisit the indirect effects that seem to be traveling
through specific microbe-metabolite pairs, which we recovered using
<code><a href="../reference/indirect_pathwise.html">indirect_pathwise()</a></code>. As with the overall indirect effects,
we can carry out a sensitvity analysis, asking how conclusions would
have changed if there had in fact been a confounder between specific
mediators and metabolites. In this example, we will look at the
strongest pathwise indirect effects that were related to Crohns Disease.
The block below correlates the pairs in each row of the
<code>confound_ix</code> data.frame. We use the same range of
correlation strengths <code>rho_seq</code> as before. Since estimating
pathwise indirect effects is more consuming than computing overall
effects, we will settle with <code>n_boot = 1</code>, which
unfortunately means we won’t have confidence bands around our
sensitivity curve.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">confound_ix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    mediator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gCholadousia"</span>, <span class="st">"gBilophila"</span>, <span class="st">"gCAG103"</span><span class="op">)</span>,</span>
<span>    outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"m0066_taurine"</span>, <span class="st">"m0066_taurine"</span>, <span class="st">"m0900_ketodeoxycholate"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#sensitivity_path &lt;- sensitivity_pathwise(model, exper, confound_ix, rho_seq, 1)</span></span>
<span><span class="va">sensitivity_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"https://go.wisc.edu/ph7ek4"</span><span class="op">)</span></span></code></pre></div>
<p>The results are given below. It seems that the estimated taurine
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>⇔</mo><annotation encoding="application/x-tex">\iff</annotation></semantics></math>
Biophila effect is quite robust: even if there had been an unobserved
confounder that correlates the mediator and outcome with strength
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">\rho = 0.5</annotation></semantics></math>,
we still see a clear indirect effect. The other two estimates require a
bit more interpretation. The taurine
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>⇔</mo><annotation encoding="application/x-tex">\iff</annotation></semantics></math>
Choladousia effect seems highly variable for small levels of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ρ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>,
and for larger values, the estimate completely vanishes. We should not
have too much confidence in this result, even for low levels of
confounding. On the other hand, the ketodeoxycholate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>⇔</mo><annotation encoding="application/x-tex">\iff</annotation></semantics></math>
CAG103 seems quite robust for smaller values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ρ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>,
but weakens under very strong confounding. This situation is more
ambiguous. It’s possible that a confounder could be responsible for the
indirect effect; however, it would have to be quite strong, perhaps
stronger than is plausible.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">confound_ix</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">sensitivity_path</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">rho</span>, <span class="va">indirect_effect</span>, group <span class="op">=</span> <span class="va">contrast</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="fl">3</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="fl">3</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Confounding parameter"</span><span class="op">~</span> <span class="va">rho</span><span class="op">)</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Estimated Indirect Effect"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>        axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>        strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="va">indirect_effect</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">mediator</span>, <span class="va">indirect_effect</span><span class="op">)</span>,</span>
<span>        scales <span class="op">=</span> <span class="st">"free_y"</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p><img src="IBD_files/figure-html/unnamed-chunk-6-1.png" width="600" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="hurdle-lognormal-approach">Hurdle-Lognormal Approach<a class="anchor" aria-label="anchor" href="#hurdle-lognormal-approach"></a>
</h2>
<p>There are many zeros in the metabolites data, and sparse regression
is not the best approach for modeling these kinds of outcomes. Indeed,
we seem to have been most sensitive to indirect effects for highly
abundant metabolites (which are present in most samples), and this
raises the question of whether we might have missed true indirect
effects where that model’s linearity assumptions were not
appropriate.</p>
<p>As an alternative, we can work with a hurdle model, which explicitly
models zeros together with a nonnegative component. For this, we’ll
return the outcomes to their original (unlogged) scaling. We’ll apply a
BRMS hurdle model. So that this isn’t too slow during the indirect
effect estimation, I’ve further reduced the number of taxa and
metabolites in this analysis.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exper2</span> <span class="op">&lt;-</span> <span class="va">exper</span></span>
<span><span class="fu"><a href="../reference/outcomes.html">outcomes</a></span><span class="op">(</span><span class="va">exper2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="../reference/outcomes.html">outcomes</a></span><span class="op">(</span><span class="va">exper2</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="../reference/mediators.html">mediators</a></span><span class="op">(</span><span class="va">exper2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mediators.html">mediators</a></span><span class="op">(</span><span class="va">exper2</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># model &lt;- multimedia(</span></span>
<span><span class="co">#     exper2,</span></span>
<span><span class="co">#     brms_model(family = hurdle_lognormal())</span></span>
<span><span class="co"># ) |&gt;</span></span>
<span><span class="co">#     estimate(exper2)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">url</a></span><span class="op">(</span><span class="st">"https://go.wisc.edu/wj197j"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>With the updated model, we can again compute pathwise indirect
effects. This time, we are more sensitive to metabolites that completely
vanish in the IBD (treatment) group. In all of the selected pairs, there
is also a treatment effect on microbe abundance. If this hadn’t been
present, and if the metabolite simply vanished, then that would be a
direct effect.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#indirect_sorted &lt;- indirect_pathwise(model, exper2) |&gt;</span></span>
<span><span class="va">indirect_sorted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"https://go.wisc.edu/r269qh"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/effect_summary.html">effect_summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_mediators.html">plot_mediators</a></span><span class="op">(</span><span class="va">indirect_sorted</span>, <span class="va">exper2</span>, treatment <span class="op">=</span> <span class="st">"Study.Group"</span><span class="op">)</span></span></code></pre></div>
<p><img src="IBD_files/figure-html/hurdle_indirect-1.png" width="600" style="display: block; margin: auto;"></p>
<p>We can see how well the hurdle model captured the zero pattern by
simulating data from the fitted model. There are a few outliers, which
is why I’ve trimmed the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>-axis.
The model has not captured the specific shape of the treatment group
scatterplots above, which tends to have regions with only zeros for some
metabolites. In retrospect, this is natural. The hurdle model can only
increase the zero probability as a linear function of species abundance.
We would need a step function preidctor to support the kinds of
transitions we see above.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">profile</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_profile.html">setup_profile</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu"><a href="../reference/treatments.html">treatments</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span>, <span class="fu"><a href="../reference/treatments.html">treatments</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">model</span>, profile <span class="op">=</span> <span class="va">profile</span>, pretreatment <span class="op">=</span> <span class="fu"><a href="../reference/pretreatments.html">pretreatments</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="../reference/outcomes.html">outcomes</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="../reference/outcomes.html">outcomes</a></span><span class="op">(</span><span class="va">exper2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_mediators.html">plot_mediators</a></span><span class="op">(</span><span class="va">indirect_sorted</span>, <span class="va">samples</span>, treatment <span class="op">=</span> <span class="st">"Study.Group"</span><span class="op">)</span></span></code></pre></div>
<p><img src="IBD_files/figure-html/hurdle_synthetic-1.png" width="600" style="display: block; margin: auto;"></p>
<p>Finally, we can look at direct effects from this model, which can be
compared to the analogous figure for the sparse regression. Now, many
outcomes with exact zeros under treatment have been detected, which is
consistent with the the hurdle model’s effectiveness in accurately
reflecting features that influence zero-inflation.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#direct &lt;- direct_effect(model, exper) |&gt;</span></span>
<span><span class="va">direct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"https://go.wisc.edu/28ft5e"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/effect_summary.html">effect_summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">direct_effect</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="va">combined</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="va">direct</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span>, <span class="va">Study.Group</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">Study.Group</span>, names_to <span class="op">=</span> <span class="st">"feature"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">feature</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">direct</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">value</span>, <span class="va">feature</span>, fill <span class="op">=</span> <span class="va">Study.Group</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="IBD_files/figure-html/hurdle_direct-1.png" width="600" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre class="r-output"><code><span><span class="co">#&gt; R version 4.4.1 Patched (2024-08-21 r87049)</span></span>
<span><span class="co">#&gt; Platform: aarch64-apple-darwin20</span></span>
<span><span class="co">#&gt; Running under: macOS Sonoma 14.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib </span></span>
<span><span class="co">#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt; [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: America/Chicago</span></span>
<span><span class="co">#&gt; tzcode source: internal</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt;  [1] multimedia_0.2.1   tidyselect_1.2.1   ranger_0.17.0      glmnetUtils_1.1.9 </span></span>
<span><span class="co">#&gt;  [5] vroom_1.6.5        lubridate_1.9.3    forcats_1.0.0      stringr_1.5.1     </span></span>
<span><span class="co">#&gt;  [9] dplyr_1.1.4        purrr_1.0.4        readr_2.1.5        tidyr_1.3.1       </span></span>
<span><span class="co">#&gt; [13] tibble_3.2.1       tidyverse_2.0.0    patchwork_1.3.0    glue_1.8.0        </span></span>
<span><span class="co">#&gt; [17] ggdist_3.3.2       compositions_2.0-8 brms_2.22.0        Rcpp_1.0.14       </span></span>
<span><span class="co">#&gt; [21] ggplot2_3.5.1     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;   [1] tensorA_0.36.2.1            jsonlite_1.8.9             </span></span>
<span><span class="co">#&gt;   [3] shape_1.4.6.1               magrittr_2.0.3             </span></span>
<span><span class="co">#&gt;   [5] TH.data_1.1-2               estimability_1.5.1         </span></span>
<span><span class="co">#&gt;   [7] farver_2.1.2                rmarkdown_2.28             </span></span>
<span><span class="co">#&gt;   [9] fs_1.6.4                    zlibbioc_1.51.1            </span></span>
<span><span class="co">#&gt;  [11] ragg_1.3.3                  vctrs_0.6.5                </span></span>
<span><span class="co">#&gt;  [13] multtest_2.61.0             htmltools_0.5.8.1          </span></span>
<span><span class="co">#&gt;  [15] S4Arrays_1.6.0              progress_1.2.3             </span></span>
<span><span class="co">#&gt;  [17] distributional_0.5.0        curl_5.2.3                 </span></span>
<span><span class="co">#&gt;  [19] Rhdf5lib_1.27.0             SparseArray_1.6.0          </span></span>
<span><span class="co">#&gt;  [21] rhdf5_2.49.0                sass_0.4.9                 </span></span>
<span><span class="co">#&gt;  [23] StanHeaders_2.32.10         bslib_0.8.0                </span></span>
<span><span class="co">#&gt;  [25] htmlwidgets_1.6.4           desc_1.4.3                 </span></span>
<span><span class="co">#&gt;  [27] plyr_1.8.9                  sandwich_3.1-1             </span></span>
<span><span class="co">#&gt;  [29] emmeans_1.10.4              zoo_1.8-12                 </span></span>
<span><span class="co">#&gt;  [31] cachem_1.1.0                igraph_2.1.4               </span></span>
<span><span class="co">#&gt;  [33] lifecycle_1.0.4             iterators_1.0.14           </span></span>
<span><span class="co">#&gt;  [35] pkgconfig_2.0.3             Matrix_1.7-0               </span></span>
<span><span class="co">#&gt;  [37] R6_2.6.0                    fastmap_1.2.0              </span></span>
<span><span class="co">#&gt;  [39] GenomeInfoDbData_1.2.12     MatrixGenerics_1.17.0      </span></span>
<span><span class="co">#&gt;  [41] digest_0.6.37               colorspace_2.1-1           </span></span>
<span><span class="co">#&gt;  [43] S4Vectors_0.43.2            textshaping_0.4.0          </span></span>
<span><span class="co">#&gt;  [45] miniLNM_0.1.0               GenomicRanges_1.57.1       </span></span>
<span><span class="co">#&gt;  [47] vegan_2.6-10                labeling_0.4.3             </span></span>
<span><span class="co">#&gt;  [49] timechange_0.3.0            fansi_1.0.6                </span></span>
<span><span class="co">#&gt;  [51] httr_1.4.7                  abind_1.4-8                </span></span>
<span><span class="co">#&gt;  [53] mgcv_1.9-1                  compiler_4.4.1             </span></span>
<span><span class="co">#&gt;  [55] bit64_4.5.2                 withr_3.0.2                </span></span>
<span><span class="co">#&gt;  [57] backports_1.5.0             inline_0.3.21              </span></span>
<span><span class="co">#&gt;  [59] highr_0.11                  QuickJSR_1.5.1             </span></span>
<span><span class="co">#&gt;  [61] pkgbuild_1.4.6              bayesm_3.1-6               </span></span>
<span><span class="co">#&gt;  [63] MASS_7.3-61                 DelayedArray_0.31.11       </span></span>
<span><span class="co">#&gt;  [65] biomformat_1.33.0           loo_2.8.0                  </span></span>
<span><span class="co">#&gt;  [67] permute_0.9-7               tools_4.4.1                </span></span>
<span><span class="co">#&gt;  [69] ape_5.8-1                   nlme_3.1-166               </span></span>
<span><span class="co">#&gt;  [71] rhdf5filters_1.17.0         grid_4.4.1                 </span></span>
<span><span class="co">#&gt;  [73] checkmate_2.3.2             cluster_2.1.6              </span></span>
<span><span class="co">#&gt;  [75] reshape2_1.4.4              ade4_1.7-22                </span></span>
<span><span class="co">#&gt;  [77] generics_0.1.3              operator.tools_1.6.3       </span></span>
<span><span class="co">#&gt;  [79] gtable_0.3.6                tzdb_0.4.0                 </span></span>
<span><span class="co">#&gt;  [81] formula.tools_1.7.1         data.table_1.16.4          </span></span>
<span><span class="co">#&gt;  [83] hms_1.1.3                   tidygraph_1.3.1            </span></span>
<span><span class="co">#&gt;  [85] XVector_0.45.0              BiocGenerics_0.52.0        </span></span>
<span><span class="co">#&gt;  [87] foreach_1.5.2               pillar_1.10.1              </span></span>
<span><span class="co">#&gt;  [89] posterior_1.6.0             robustbase_0.99-4-1        </span></span>
<span><span class="co">#&gt;  [91] splines_4.4.1               lattice_0.22-6             </span></span>
<span><span class="co">#&gt;  [93] bit_4.5.0                   survival_3.7-0             </span></span>
<span><span class="co">#&gt;  [95] Biostrings_2.73.1           knitr_1.48                 </span></span>
<span><span class="co">#&gt;  [97] gridExtra_2.3               V8_5.0.1                   </span></span>
<span><span class="co">#&gt;  [99] phyloseq_1.49.0             IRanges_2.39.2             </span></span>
<span><span class="co">#&gt; [101] SummarizedExperiment_1.35.1 stats4_4.4.1               </span></span>
<span><span class="co">#&gt; [103] xfun_0.47                   bridgesampling_1.1-2       </span></span>
<span><span class="co">#&gt; [105] Biobase_2.65.1              matrixStats_1.5.0          </span></span>
<span><span class="co">#&gt; [107] DEoptimR_1.1-3              rstan_2.32.6               </span></span>
<span><span class="co">#&gt; [109] stringi_1.8.4               UCSC.utils_1.1.0           </span></span>
<span><span class="co">#&gt; [111] yaml_2.3.10                 evaluate_1.0.0             </span></span>
<span><span class="co">#&gt; [113] codetools_0.2-20            cli_3.6.3                  </span></span>
<span><span class="co">#&gt; [115] RcppParallel_5.1.10         xtable_1.8-4               </span></span>
<span><span class="co">#&gt; [117] systemfonts_1.1.0           munsell_0.5.1              </span></span>
<span><span class="co">#&gt; [119] jquerylib_0.1.4             GenomeInfoDb_1.41.1        </span></span>
<span><span class="co">#&gt; [121] coda_0.19-4.1               parallel_4.4.1             </span></span>
<span><span class="co">#&gt; [123] rstantools_2.4.0            pkgdown_2.1.1              </span></span>
<span><span class="co">#&gt; [125] prettyunits_1.2.0           bayesplot_1.11.1           </span></span>
<span><span class="co">#&gt; [127] Brobdingnag_1.2-9           glmnet_4.1-8               </span></span>
<span><span class="co">#&gt; [129] mvtnorm_1.3-3               scales_1.3.0               </span></span>
<span><span class="co">#&gt; [131] crayon_1.5.3                rlang_1.1.5                </span></span>
<span><span class="co">#&gt; [133] multcomp_1.4-26</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kris Sankaran, Hanying Jiang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
